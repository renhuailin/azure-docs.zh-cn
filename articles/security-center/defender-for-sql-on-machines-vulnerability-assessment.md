---
title: 使用适用于 SQL Server 的 Azure 安全中心集成式漏洞评估扫描程序
description: 了解适用于计算机上 SQL Server 的 Azure Defender 的集成式漏洞评估扫描程序
author: memildin
ms.author: memildin
manager: rkarlin
ms.service: security-center
ms.topic: how-to
ms.date: 09/14/2021
ms.openlocfilehash: 16b97e05268c80c7a1651b1a980a7ce95acaa034
ms.sourcegitcommit: 860f6821bff59caefc71b50810949ceed1431510
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/09/2021
ms.locfileid: "129711780"
---
# <a name="scan-your-sql-servers-for-vulnerabilities"></a>扫描 SQL Server 是否存在漏洞

适用于计算机上的 SQL Server 的 Azure Defender 会扩展对 Azure 原生 SQL Server 的保护以完全支持混合环境，并保护在 Azure、其他云环境，甚至本地计算机上托管的 SQL server（所有受支持的版本）：

- [虚拟机上的 SQL Server](https://azure.microsoft.com/services/virtual-machines/sql-server/)
- 本地 SQL Server：
  - [已启用 Azure Arc 的 SQL Server（预览版）](/sql/sql-server/azure-arc/overview)
  - [在不带 Azure Arc 的 Windows 计算机上运行的 SQL Server](../azure-monitor/agents/agent-windows.md)

集成式[漏洞评估扫描程序](../azure-sql/database/sql-vulnerability-assessment.md)可发现、跟踪并帮助你修正潜在的数据库漏洞。 评估扫描结果会概述 SQL 计算机的安全状态以及任何安全发现结果的详细信息。

> [!NOTE]
> 扫描是轻量级且安全的，每个数据库只需几秒钟即可运行，并且完全是只读的。 此功能不会对数据库做出任何更改。 

## <a name="explore-vulnerability-assessment-reports"></a>浏览漏洞评估报告

漏洞评估服务每 12 小时扫描数据库一次。

漏洞评估仪表板会概述对所有数据库的评估结果、正常和不正常数据库的摘要，以及根据风险分布失败的检查的总体摘要。

可以直接在安全中心查看漏洞评估结果。

1. 在安全中心的边栏中，打开“建议”页。

1. 选择建议“应修正关于计算机上 SQL Server 的漏洞评估结果(预览)”。 有关详细信息，请参阅[安全中心建议参考页](security-center-recommendations.md)。 

    :::image type="content" source="./media/security-center-advanced-iaas-data/data-and-storage-sqldb-vulns-on-vm.png" alt-text="应修正关于计算机上的 SQL 服务器的漏洞评估结果（预览版）":::

    此时显示此建议的详细视图。

    :::image type="content" source="./media/defender-for-sql-on-machines-vulnerability-assessment/sql-vulnerability-findings.png" alt-text="此建议的详细视图。":::

1. 如需更多详细信息，请向下钻取：

    - 如需已扫描资源（数据库）的概述和已测试的安全检查列表，请打开“受影响的资源”并选择相关服务器。

    - 如需按特定 SQL 数据库分组的漏洞的概述，请选择相关数据库。

    在每个视图中，安全检查按照严重性排序。 选择特定安全检查以查看详细信息窗格，其中包含说明、修正方法以及“影响”或“基准”等其他相关信息   。

## <a name="set-a-baseline"></a>设置基线 

在查看评估结果时，可将结果标记为环境中可接受的基线。 基线其实就是自定义结果的报告方式。 与基线匹配的结果被视为通过后续扫描。 建立基线安全状态后，漏洞评估扫描器仅报告与基线的偏差。 这样，你可以专注于处理相关问题。

:::image type="content" source="media/defender-for-sql-on-machines-vulnerability-assessment/analyze-report-for-details.png" alt-text="在查看评估结果时，可将结果标记为环境中可接受的基线。":::

## <a name="export-results"></a>导出结果

使用 Azure 安全中心的[连续导出](continuous-export.md)功能，将漏洞评估结果导出到 Azure 事件中心或 Log Analytics 工作区。 

## <a name="view-vulnerabilities-in-graphical-interactive-reports"></a>在交互式图形报告中查看漏洞

安全中心的集成式 Azure Monitor 工作簿库包括一份交互式报告，其中包含漏洞扫描程序在计算机、容器注册表中的容器和 SQL Server 中检测到的所有结果。

每个扫描程序的结果在单独的建议中报告：

- 应修正虚拟机中的漏洞
- 应修正 Azure 容器注册表映像中的漏洞（由 Qualys 提供技术支持）
- 应修正关于 SQL 数据库的漏洞评估结果
- 应修正关于计算机上 SQL 服务器的漏洞评估结果

“漏洞评估结果”报告收集所有这些结果，并按严重性、资源类型和类别对其进行组织。 可以在安全中心边栏中的工作簿库找到该报告。

:::image type="content" source="media/defender-for-sql-on-machines-vulnerability-assessment/vulnerability-assessment-findings-report-sql.png" alt-text="安全中心的漏洞评估结果报告":::


## <a name="disable-specific-findings-preview"></a>禁用特定结果（预览版）

如果组织需要忽略发现结果，而不是修正漏洞，则可以选择禁用发现结果。 禁用发现结果不会影响安全分数，也不会产生有害的噪音。

当发现结果与在禁用规则中定义的条件相匹配时，它不会显示在发现结果列表中。 典型方案包括：

- 禁用严重性低于中等的结果
- 禁用不可修补的发现结果
- 禁用与定义的范围无关的基准的发现结果

> [!IMPORTANT]
> 若要禁用特定发现结果，你需要拥有在 Azure Policy 中编辑策略的权限。 若要了解详细信息，请参阅 [Azure Policy 中的 Azure RBAC 权限](../governance/policy/overview.md#azure-rbac-permissions-in-azure-policy)。

若要创建规则，请执行以下操作：

1. 在“应修正关于计算机上 SQL Server 的漏洞评估结果”的建议详细信息页中，选择“禁用规则” 。

1. 选择相关范围。

1. 定义你的条件。 可以使用以下任一条件： 
    - 发现结果 ID 
    - 严重性 
    - 基准 

    :::image type="content" source="./media/defender-for-sql-on-machines-vulnerability-assessment/disable-rule-vulnerability-findings-sql.png" alt-text="针对在计算机中的 SQL Server 上检测到的漏洞评估结果创建禁用规则。":::

1. 选择“应用规则”。 更改可能需要 24 小时才能生效。

1. 若要查看、替代或删除规则，请执行以下操作： 

    1. 选择“禁用规则”。

    1. 在范围列表中，具有有效规则的订阅显示为“已应用规则”。

        :::image type="content" source="./media/remediate-vulnerability-findings-vm/modify-rule.png" alt-text="修改或删除现有规则。":::

    1. 若要查看或删除规则，请选择省略号菜单（“...”）。

## <a name="manage-vulnerability-assessments-programmatically"></a>以编程方式管理漏洞评估

### <a name="using-azure-powershell"></a>使用 Azure PowerShell

可以使用 Azure PowerShell cmdlet 以编程方式管理漏洞评估。 受支持的 cmdlet 如下：

| Cmdlet 名称（链接） | 说明 |
| :-------------------- | :---------- |
| [Add-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/add-azsecuritysqlvulnerabilityassessmentbaseline) | 添加 SQL 漏洞评估基线。 |
| [Get-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentbaseline) | 获取 SQL 漏洞评估基线。 |
| [Get-AzSecuritySqlVulnerabilityAssessmentScanResult](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentscanresult) | 获取 SQL 漏洞评估扫描结果。 |
| [Get-AzSecuritySqlVulnerabilityAssessmentScanRecord](/powershell/module/az.security/get-azsecuritysqlvulnerabilityassessmentscanrecord) | 获取 SQL 漏洞评估扫描记录。 |
| [Remove-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/remove-azsecuritysqlvulnerabilityassessmentbaseline) | 删除 SQL 漏洞评估基线。 |
| [Set-AzSecuritySqlVulnerabilityAssessmentBaseline](/powershell/module/az.security/set-azsecuritysqlvulnerabilityassessmentbaseline) | 在一个特定的数据库上设置新 SQL 漏洞评估基线会丢弃旧基线（如果存在）。 |
| &nbsp; | &nbsp; |

## <a name="data-residency"></a>数据驻留

SQL 漏洞评估使用安全中心 SQL 漏洞评估建议下的公开可用查询来查询 SQL 服务器，并存储查询结果。 SQL 漏洞评估数据存储在计算机连接到的 Log Analytics 工作区的位置。 例如，如果用户将 SQL 虚拟机连接到西欧的 Log Analytics 工作区，则结果会存储在西欧。 仅当在 Log Analytics 工作区上启用 SQL 漏洞评估解决方案时，才会收集此数据。

还会收集有关连接的计算机的元数据信息。 具体而言：

-   操作系统名称、类型和版本
-   计算机完全限定域名 (FQDN)
-   Connected Machine 代理版本
-   UUID (BIOS ID)
-   SQL Server 名称和基础数据库名称

SQL 漏洞评估允许你通过选择 Log Analytics 工作区位置来指定存储数据的区域。 Microsoft 可能会将数据复制到其他区域来提高数据复原能力，但 Microsoft 不会将数据复制到相应地理位置之外。

## <a name="next-steps"></a>后续步骤

在 [Azure Defender for SQL 简介](defender-for-sql-introduction.md)中详细了解安全中心为 SQL 资源提供的保护。
