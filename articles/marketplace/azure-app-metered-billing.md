---
title: 使用市场计量服务对托管应用程序按流量计费 |Azure 市场
description: 本文档为 ISV 发布采用灵活计费模式的 Azure 应用程序（Azure 市场）提供指南。
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 07/01/2021
ms.author: mingshen
author: mingshen-ms
ms.openlocfilehash: 1571ae7a735f9d7cf05ce0724cfe3aeb9de70f0b
ms.sourcegitcommit: 285d5c48a03fcda7c27828236edb079f39aaaebf
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/02/2021
ms.locfileid: "113231298"
---
# <a name="managed-application-metered-billing"></a>托管应用程序按流量计费 

利用市场计量服务，你可以为采用非标准单位收费的 Azure 应用程序产品/服务创建托管应用程序计划。 在发布产品/服务之前，需要定义计费维度，如带宽、票证或处理的电子邮件。 之后客户根据这些维度的使用量付费。  当可计费事件发生时，系统将通过市场计量服务 API 通知 Microsoft 这些事件。

## <a name="prerequisites-for-metered-billing"></a>按流量计费的先决条件

为使托管应用程序计划使用按流量计费，该计划必须：

* 满足[创建 Azure 应用程序产品/服务](azure-app-offer-setup.md)中所述的所有产品/服务要求。
* 配置定价，从而按月向客户收取服务费用。 如果不想收取固定费用，而是完全依赖于按流量计费，则价格可以为零。
* 针对客户将支付的流量事件，设置“计费维度”优先于单一费率。
* 与[市场计量服务 API](./marketplace-metering-service-apis.md) 集成，通知 Microsoft 可计费事件。

## <a name="how-metered-billing-fits-in-with-pricing"></a>按流量计费如何定价

在定义产品/服务及其定价模型时，必须了解产品/服务的层次结构。

* 每个 Azure 应用程序产品/服务都可以具有解决方案模板或托管应用程序计划。
* 按流量计费仅在托管应用程序计划中实现。
* 每个托管应用程序计划都具有一个与之关联的定价模型。 
* 定价模型按月收取费用，可将其设置为 0 美元。
* 除了周期性费用以外，该计划还可以使用可选的维度，针对单一费率中未包括的使用量向客户收取费用。 每个维度表示你的服务通过[市场计量服务 API](marketplace-metering-service-apis.md) 与 Microsoft 通信将使用的计费单位。

## <a name="sample-offer"></a>示例产品/服务

例如，Contoso 是名为 Contoso Analytics (CoA) 的托管应用程序服务的发布者。 CoA 允许客户分析大量数据以用于报表和数据仓库。 Contoso 注册为“合作伙伴中心”的发布者，以便商业市场计划面向 Azure 客户发布产品/服务。 提供两个与 CoA 关联的计划，如下所述：

* 基本计划
    * 分析 100 GB，生成 100 个报表，费用为 0 美元/月
    * 超过 100 GB，每 1 GB 支付 10 美元
    * 超过 100 个报表，每个报表支付 1 美元
* 高级计划
    * 分析 1000 GB，生成 1000 个报表，费用为 350 美元/月
    * 超过 1000 GB，每 1 TB 支付 100 美元
    * 超过 1000 个报表，每个报表支付 0.5 美元

订阅 CoA 服务的 Azure 客户可以根据所选计划每月分析和生成报表。 Contoso 度量使用量未超出已包含数量，不会向 Microsoft 发送任何使用量事件。 当客户使用量超出已包含数量时，他们无需更改计划或执行其他任何操作。 Contoso 将度量超出已包含数量的超额，并使用[市场计量服务 API](./marketplace-metering-service-apis.md) 开始向 Microsoft 发送关于额外使用量的使用量事件。 Microsoft 则将根据发布者指定的额外使用量向客户收取费用。

## <a name="billing-dimensions"></a>计费维度

计费维度用于向客户传达有关软件使用的计费方式。  这些维度还用于向 Microsoft 传达使用量事件。 它们的定义如下：

* **维度标识符**：发送使用量事件时引用的不可变标识符。
* **维度名称**：与维度关联的显示名称，例如“已发送文本消息”。
* **度量单位**：计费单位的说明，例如“每条文本消息”或“每 100 封电子邮件”。
* **单价**：单位维度的价格。
* **每月已包含数量**：客户支付月费所对应的每月包含的维度数量，该数量必须是整数。

一个产品/服务的所有计划共享计费维度。 某些属性适用于所有计划的维度，其他属性则特定于计划。

定义维度本身的属性则共享于一个产品/服务的所有计划。 在发布产品/服务之前，从任何计划的上下文中对这些属性进行更改都将影响所有计划的维度定义。 发布产品/服务后，将无法再编辑这些属性。 这些属性为：

* 标识符
* 名称
* 度量单位

维度的其他属性特定于每个计划，且不同的计划可以有不同的值。  在发布计划之前，你可以编辑这些值，且只会对该计划产生影响。 发布计划后，将无法再编辑这些属性。 这些属性为：

* 每个单位的价格
* 月度客户已包含数量 
* 年度客户已包含数量 

维度还具有两个特殊概念：“已启用”和“无限”：

* **已启用** - 指示此计划使用此维度。  如果要创建的新计划不会基于此维度发送使用量事件，则可能想要取消选中此选项。 此外，在首次发布计划后添加的任何新维度在已发布的计划中都将显示为“未启用”。  禁用的维度将不会显示在客户所见计划的任何维度列表中。
* **无限**，由无穷符号“∞”表示，指示此计划使用此维度，而此维度不计量使用。 你希望指示客户，此维度所表示的功能包含在计划中，但没有使用量限制。  具有无限使用量的维度将显示在客户所见计划的维度列表中。  此计划永远不会产生费用。

>[!Note] 
>显式支持以下方案：  <br> - 可以将新维度添加到新计划。  对于任何已发布的计划，将不启用新维度。 <br> - 您可以发布不包含任何维度的固定月度费用计划，然后添加新计划并为该计划配置一个新维度。 对于已发布的计划，将不启用新维度。

## <a name="constraints"></a>约束

### <a name="locking-behavior"></a>锁定行为

与市场计量服务配合使用的维度表示了解客户将如何为服务付费。  发布产品/服务后，将无法再编辑维度的所有详细信息。  在发布产品/服务之前，请务必完整定义维度。

使用维度发布产品/服务后，将无法再更改该维度的产品/服务级别的详细信息：

* 标识符
* 名称
* 度量单位

发布计划后，将无法再更改计划级别的详细信息：

* 每个单位的价格
* 月度已包含数量
* 是否为此计划启用此维度

>[!Note]
>Azure 政府云目前尚不支持使用市场计量服务的按流量计费。

### <a name="upper-limits"></a>上限

单个产品/服务可配置的最大维度数量为 30 个唯一维度。

## <a name="get-support"></a>获取支持

如果遇到以下问题之一，你可以打开支持票证。

* 市场计量服务 API 的技术问题。
* 由于自身错误或 bug （例如错误的使用量事件） 而需要升级的问题。
* 与按流量计费相关的任何其他问题。

遵照[合作伙伴中心商业市场计划的支持](support.md)中的说明，了解发布者支持选项和使用 Microsoft 打开支持票证。

## <a name="next-steps"></a>后续步骤

- 有关详细信息，请参阅[市场计量服务 API](marketplace-metering-service-apis.md)。
