### YamlMime:FAQ
metadata:
  title: 计量服务 API 常见问题解答 - Microsoft 商业市场
  description: 有关 Microsoft AppSource 和 Azure 市场中 SaaS 服务/产品的计量服务 API 的常见问题解答。
  ms.service: marketplace
  ms.subservice: partnercenter-marketplace-publisher
  ms.topic: conceptual
  ms.date: 06/01/2020
  author: saasguide
  ms.author: souchak
  ms.openlocfilehash: 0abeb7dd6573293a72e8b6aede6f5e281b553049
  ms.sourcegitcommit: 557ed4e74f0629b6d2a543e1228f65a3e01bf3ac
  ms.translationtype: HT
  ms.contentlocale: zh-CN
  ms.lasthandoff: 10/05/2021
  ms.locfileid: "129455297"
title: 市场按流量计费 API - 常见问题解答
summary: 在客户订阅了按流量计费的 SaaS 服务或 Azure 应用程序（该应用程序采用托管应用计划）后，你将会跟踪所用每个计费维度的消耗量。  如果消耗量超过了根据客户所选条款设置的已包含数量，则服务将向 Microsoft 发送使用事件。
sections:
- name: 适用于 SaaS 产品/服务和托管应用
  questions:
  - question: >
      使用情况信息多久发出一次？
    answer: >
      理想情况下，预期会每隔一小时发出过去一小时的使用情况信息，但前提是过去一小时内客户使用了产品/服务或应用。
  - question: >
      每两次发出信息的最长间隔时间有限制吗？
    answer: >
      没有这方面的限制。 使用情况信息只会在有客户使用时才会发出。 例如，如果在每个订阅生存期内你只需提交一个单位的使用情况，你可以这样做。
  - question: >
      事件发生时间与将使用事件发出到 Microsoft 的时间之间的最大延迟是多少？
    answer: >
      理想情况下，会每隔一小时针对过去一小时发生的事件发出使用事件。 但预期会出现延迟。 允许的最大延迟为 24 小时，超过此时间后将不接受使用事件。 最佳做法是收集每小时的使用情况，并在一小时结束时将这些信息作为一个事件发出。


      例如，如果使用事件发生在某天的下午 1 点，则与此事件关联的使用事件将在第二天的下午 1 点发出。  如果发出使用情况信息的系统已关闭，该系统可以恢复，然后发送在使用活动发生时所在的时间间隔内的使用事件，而不会损失保真度。


      如果在实际使用后已超过 24 小时，你仍可以通过后续的使用事件发出消耗的单位。  但是，这种做法可能会损害最终客户计费事件报告的可信度。  建议不要每日/每周/每月发送计量数据一次。  这会导致更难了解客户的实际使用情况，以及更难解决用户可能提出的有关使用事件的问题或疑问。


      每隔一小时发送使用情况信息的另一个原因是避免在发布者发送每日/每周/每月事件之前用户取消订阅的情况。
  - question: >
      如果在同一小时发送多个使用事件，会发生什么情况？
    answer: >
      一小时间隔仅接受一个使用事件。 小时间隔从第 0 分钟开始，到第 59 分钟结束。  如果在同一小时发出多个使用事件，则会将所有后续使用事件作为重复项删除。
  - question: >
      如果客户在“取消”策略允许的时间内取消购买，会发生什么情况？
    answer: >
      将不会按统一费率计费，而是按超额用量计费。
  - question: >
      自定义计量计划是否可用于一次性付款？
    answer: >
      是的，可将自定义维度定义为一个单位的一次性付款，并仅为每个客户发出此信息一次。
  - question: >
      自定义计量计划是否可用于分层定价模型？
    answer: >
      是的，可以使用代表单个定价层的每个自定义维度来实现此方案。


      例如，Contoso 希望针对前 1000 封电子邮件中的每封电子邮件收取 $0.5，针对第 1000 到 5000 封电子邮件中的每封电子邮件收取 $0.4，并针对第 5000 封以后的每封电子邮件收取 $0.2。 他们可以定义与三个电子邮件定价层对应的三个自定义维度。 如果电子邮件数量少于 1000，则发出第一个维度的单位；如果电子邮件数量介于 1000 至 5000 之间，则发出第二个维度的单位；如果电子邮件数量超过 5000，则发出第三个维度的单位。
  - question: >
      如果市场计量服务中断，会发生什么情况？
    answer: >
      如果 ISV 在发送自定义计量信息时收到了错误，而导致该错误的可能原因是 Microsoft 端出现了问题（通常的情况是以前接受过类似的事件但未出错），则 ISV 应等待一段时间后重试发出。


      如果错误仍然出现，则需要在下一个小时重新提交该自定义计量信息（累积数量）。 请不断执行此过程，直到收到不包含错误的响应。
- name: 仅适用于 SaaS 产品/服务
  questions:
  - question: >
      发出已被取消订阅的 SaaS 订阅的使用情况信息时会发生什么情况？
    answer: >
      删除 SaaS 订阅后，将不会接受任何发出到市场平台的使用事件。


      只能为处于 Subscribed（已订阅）状态的订阅发出使用情况信息（而不能为处于 `PendingFulfillmentStart`、`Suspended` 或 `Unsubscribed` 状态的订阅发出）。


      唯一的例外是报告在 SaaS 订阅取消之前那段时间的使用情况。


      例如，客户在今天下午 3 点取消了 SaaS 订阅， 现在为下午 5 点。发布者仍可发出此 SaaS 订阅在昨天下午 6 点至今天下午 3 点的使用情况。
  - question: >
      是否可以获取所有 SaaS 订阅（包括活动订阅和已取消的订阅）的列表？
    answer: >
      是的，调用[获取订阅列表 API](partner-center-portal/pc-saas-fulfillment-api-v2.md#subscription-apis) 即可获取所有 SaaS 订阅的列表。 对每个 SaaS 订阅的响应中的状态字段将指明该订阅是处于活动状态还是已取消状态。
  - question: >
      SaaS 订阅期限的开始和结束日期与发出超额用量信息是否有关联？
    answer: "对于处于 Subscribed 状态的现有 SaaS 订阅，可在任何时间点发出超额事件。 由发布者负责根据计费计划中定义的策略发出使用事件。 必须根据 SaaS 订阅期限中定义的日期计算超额。 \n\n例如，如果发布者定义了一个 SaaS 计划，其中规定，对于前 1000 封电子邮件，按每月统一费率收取 $100；对于 1000 封以后的每封电子邮件，通过自定义维度收取 $1。\n\n如果客户在 1 月 6 日购买并激活了订阅，则从当天开始对采用统一费率的 1000 封电子邮件计数。 因此，如果到 2 月 5 日（第一个订阅月份的最后一日）只发送了 900 封电子邮件，则客户只需按固定费率支付此订阅第一个月的费用，而发布者不会发出 1 月 6 日至 2 月 5 日的超额使用事件。 在 2 月 6 日，订阅将自动续订，计数重新开始。 如果在 2 月 15 日客户发送的电子邮件达到了 1000 封，则对于在 3 月 5 日之前发送的其余电子邮件，将根据发布者发出的超额使用事件，按照超额用量收费（每封电子邮件收取 $1）。\n"
additionalContent: "\n## <a name=\"next-steps\"></a>后续步骤\n\n- 有关详细信息，请参阅[市场计量服务 API](./marketplace-metering-service-apis.md)。"
