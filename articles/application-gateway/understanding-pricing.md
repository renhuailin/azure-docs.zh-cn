---
title: 了解定价 - Azure 应用程序网关
description: 本文介绍对 v1 到 v2 SKU 都适用的 Azure 应用程序网关和 Web 应用程序防火墙的计费过程
services: application-gateway
author: azhar2005
ms.service: application-gateway
ms.topic: conceptual
ms.custom: references_regions
ms.date: 09/01/2020
ms.author: azhussai
ms.openlocfilehash: 8c6afc21ce2dd4ba08a29d2a1c19e680b838c9ee
ms.sourcegitcommit: 0046757af1da267fc2f0e88617c633524883795f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/13/2021
ms.locfileid: "121737239"
---
# <a name="understanding-pricing-for-azure-application-gateway-and-web-application-firewall"></a>了解 Azure 应用程序网关和 Web 应用程序防火墙的定价

>[!NOTE]
>本文中所示价格均为示例，仅用于解释说明。 若要了解你所在区域的定价，请参阅[定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

Azure 应用程序网关是第 7 层负载均衡解决方案，该方案可在 Azure 上实现可缩放的、高度可用的并且安全的 Web 应用程序交付。

应用程序网关不会产生预付成本或终止成本。
你将只需要根据实际的每小时消耗量为事先预配的和使用的资源付费。 与应用程序网关关联的成本分为两个组成部分：固定成本和可变成本。 每个部分内的实际成本都会因使用的 SKU 而异。

本文介绍与每个 SKU 相关的成本，建议用户使用本文档来规划和管理与 Azure 应用程序网关相关的成本。

## <a name="v1-skus"></a>V1 SKU

标准应用程序网关和 WAF V1 SKU 按以下方式组合计费：

* 固定成本

    基于预配某种特定类型应用程序网关/WAF 以及运行它来处理请求的时间的成本。
    固定成本部分考虑以下因素：
    * 层级 - 标准应用程序网关或 WAF
    * 大小 - 小型、中型和大型
    * 实例计数 - 要部署的实例的数量

    对于 N 个实例，关联的成本将会是某个特定层级（标准和 WAF）和大小（小型、中型和大型）组合的一个实例的成本 x N。

* 可变成本

    基于由应用程序网关/WAF 处理的数据量的成本。 由应用程序网关处理的请求和响应字节都会被视为需要计费。

总成本 = 固定成本 + 可变成本

### <a name="standard-application-gateway"></a>标准应用程序网关

固定成本和可变成本将会根据应用程序网关类型来计算。
下表显示了基于美国东部定价快照的示例价格，仅用于说明。

#### <a name="fixed-cost-east-us-region-pricing"></a>固定成本（美国东部区域定价）

|              应用程序网关类型             |  成本（美元/小时）  |
| ------------------------------------------------- | ---------------|
|                     小                         |    0\.025 美元      |
|                     中型                        |    0\.07 美元       |
|                     大                         |    0\.32 美元       |

每月价格估算基于每个月使用 730 小时。

#### <a name="variable-cost-east-us-region-pricing"></a>可变成本（美国东部区域定价）

|              已处理的数据             |  小型（美元/GB）  |  中型（美元/GB） |  大型（美元/GB） |
| --------------------------------------- | -------------- | -------------- | ------------- |
| 前 10 TB/月                       |     0\.008 美元     |      免费      |     免费      |
| 下一个 30 TB (10–40 TB)/月             |     0\.008 美元     |     0\.007 美元     |     免费      |
| 超过 40 TB 的部分/月                        |     0\.008 美元     |     0\.007 美元     |     0\.0035 美元   |

若要详细了解你所在区域的定价，请参阅[定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

### <a name="waf-v1"></a>WAF V1

固定成本和可变成本将会根据预配的应用程序网关类型来计算。

下表显示了基于美国东部定价快照的示例价格，仅用于说明。

#### <a name="fixed-cost-east-us-region-pricing"></a>固定成本（美国东部区域定价）

|              应用程序网关类型             |  成本（美元/小时）  |
| ------------------------------------------------- | ---------------|
|                     小                         |       NA       |
|                     中型                        |     0\.126 美元     |
|                     大                         |     0\.448 美元     |

每月价格估算基于每个月使用 730 小时。

#### <a name="variable-cost-east-us-region-pricing"></a>可变成本（美国东部区域定价）

|              已处理的数据             |  小型（美元/GB）  |  中型（美元/GB） |  大型（美元/GB） |
| --------------------------------------- | -------------- | -------------- | ------------- |
| 前 10 TB/月                       |     0\.008 美元     |      免费      |     免费      |
| 下一个 30 TB (10–40 TB)/月             |     0\.008 美元     |     0\.007 美元     |     免费      |
| 超过 40 TB 的部分/月                        |     0\.008 美元     |     0\.007 美元     |     0\.0035 美元   |

若要详细了解你所在区域的定价，请参阅[定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

> [!NOTE]
> 出站数据传输 - 通过应用程序网关从 Azure 数据中心传出的数据将会按照标准[数据传输费率](https://azure.microsoft.com/pricing/details/bandwidth/)进行收费。

### <a name="example-1-a--standard-application-gateway-with-1-instance-count"></a>示例 1 (a) - 实例计数为 1 的标准应用程序网关

假定你预配了包含1个实例的中型标准应用程序网关，并且该网关每月处理 500 GB。 使用上述定价方式的应用程序网关成本计算如下：

固定成本 = 0.07 美元 x 730（小时）= 51.1 美元，每月价格估算基于每个月使用 730 小时。

可变成本 = 免费（中型层级对于每月处理的前 10 TB 没有成本），总成本 = 51.1 美元 + 0 = 51.1 美元 

> [!NOTE]
> 若要支持高可用性方案，最少需要为 V1 SKU 设置 2 个实例。 请参阅[应用程序网关的 SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_2/)

### <a name="example-1-b--standard-application-gateway-with--1-instance-count"></a>示例 1 (b) - 实例计数大于 1 的标准应用程序网关

假定你预配了包含五个实例的中型标准应用程序网关，并且该网关每月处理 500 GB。 使用上述定价方式的应用程序网关成本计算如下：

固定成本 = 5（实例计数）x 0.07 美元 x 730（小时）= 255.5 美元，每月价格估算基于每个月使用 730 小时。

可变成本 = 免费（中型层级对于每月处理的前 10 TB 没有成本），总成本 = 255.5 美元 + 0 = 255.5 美元 

### <a name="example-2--waf-application-gateway"></a>示例 2 - WAF 应用程序网关

假设你已在当月的前 15 天中预配了小类型标准应用程序网关和大类型 WAF 应用程序网关。 小型应用程序网关在其处于活动状态的持续期中处理 15 TB，大型 WAF 应用程序网关在其处于活动状态的持续期中处理 100 TB。 应用程序网关成本采用上述定价方式计算如下： 

###### <a name="small-instance-standard-application-gateway"></a>小型实例标准应用程序网关

24 小时 x 15 天 = 360 小时

固定价格 = 0.025 美元 x 360（小时）= 9 美元

可变成本 = 10 x 1000 x 0.008 美元/GB + 5 x 1000 x 0.008 美元/GB = 120 美元

总成本 = 美元 9 + 120 美元 = 129 美元

###### <a name="large-instance-waf-application-gateway"></a>大型实例 WAF 应用程序网关
24 小时 x 15 天 = 360 小时

固定价格 = 0.448 美元 x 360（小时）= 161.28 美元

可变成本 = 60 x 1000 x 0.0035 美元/GB = 210 美元（“大型”层级在每月处理前 40 TB 时没有成本）

总成本 = 161.28 美元 + 210 美元 = 371.28 美元

## <a name="v2-skus"></a>V2 SKU  

在默认情况下，应用程序网关 V2 和 WAF V2 SKU 支持自动缩放并且会保证高可用性。

### <a name="key-terms"></a>主要术语

##### <a name="capacity-unit"></a>容量单位 
容量单位是在多个参数间对应用程序网关的容量利用率的度量。

一个容量单位由以下参数组成：
* 2500 个持久连接
* 2.22-Mbps 吞吐量
* 1 个计算单位

如果这些参数中有任何一个出现了超出的情况，就会另外需要 n 个容量单位，即使其他两个参数没有超出此单个容量单元的限制也是如此。
在上述三个参数中，利用率最高的参数将会在内部被用于计算容量单位，这样进而又会产生费用。

##### <a name="compute-unit"></a>计算单位
计算单位是已消耗的计算容量的度量值。 影响计算单位消耗的因素是 TLS 连接数/秒、URL 重写计算，以及 WAF 规则处理。 计算单位可以处理的请求数取决于各种不同条件，例如 TLS 证书密钥大小、密钥交换算法、标头重写，以及传入请求大小（在使用 WAF 时）。

计算单位指导：
* Standard_v2 - 每个计算单位每秒可以使用 RSA 2048 位密钥 TLS 证书处理大约 50 个连接。

* WAF_v2 - 如果流量混合率为 70-30%，且 70% 的请求小于 2 KB GET/POST，剩余请求的计算量更高，则每个计算单位可支持每秒大约 10 个并发请求。 目前，WAF 性能不受响应大小的影响。

##### <a name="instance-count"></a>实例计数 
为应用程序网关 V2 SKU 预配资源的方式是根据实例计数来定义的。 每个实例都保证最少 10 个容量单位的处理能力。 根据容量单位参数不同，对于不同的流量模式，同一实例也许可以支持 10 个以上的容量单位。

为自动缩放设置的手动定义的规模和限制（最小值或最大）是根据实例计数来设置的。 在自动缩放配置中为实例计数和最小实例计数手动设置的规模将会为每个实例保留 10 个容量单位。 只要应用程序网关处于活动状态，无论实际的资源消耗情况如何，都会对这些保留的 CU 计费。 如果实际消耗超过 10 个容量单位/实例阈值，则会对更多的容量单位按变量组件计费。

V2 SKU 会根据消耗情况计费，并由两部分组成：

* 固定成本

    根据应用程序网关 V2/WAF V2 预配的时间和可用于处理请求的时间计算的成本。 这样会确保高可用性 - 即使在自动缩放过程中通过将最小实例计数指定为 0来保留 0 个实例也是如此。 
    
    固定成本还包括与附加到应用程序网关的公共 IP 关联的成本。

    在任何时间点运行的实例数都不会被视为 V2 SKU 固定成本的因素。 无论在同一 Azure 区域中运行的实例有多少，运行 Standard_V2（或 WAF_V2）的每小时固定成本都会是相同的。

* 容量单位成本 

    根据保留的容量单位数或者是根据为了处理传入请求而需要额外使用的容量单位数来计算的成本。  基于消耗量的成本会按小时计算。

总成本 = 固定成本 + 容量单位成本

> [!NOTE]
> 不足 1 小时会按完整的 1 小时计费。

下表显示了基于美国东部定价快照的示例价格，仅用于说明。

#### <a name="fixed-costs-east-us-region-pricing"></a>固定成本（美国东部区域定价）

|              V2 SKU             |  成本（美元/小时）  |
| ------------------------------- | ---------------|
|            Standard_V2          |     0\.246 美元     |
|              WAF_V2             |     0\.443 美元     |

每月价格估算基于每个月使用 730 小时。

#### <a name="variable-costs-east-us-region-pricing"></a>可变成本（美国东部区域定价）

|        容量单位         |  Standard_V2（美元/小时）  |  WAF_V2（美元/小时） |
| ---------------------------- | -------------------- | -------------- |
|             1 个 CU             |        0\.008 美元        |     0\.0144 美元    |

若要详细了解你所在区域的定价，请参阅[定价页](https://azure.microsoft.com/pricing/details/application-gateway/)。

> [!NOTE]
> 出站数据传输 - 通过应用程序网关从 Azure 数据中心传出的数据将会按照标准[数据传输费率](https://azure.microsoft.com/pricing/details/bandwidth/)进行收费。

### <a name="example-1-a--manual-scaling"></a>示例 1 (a) – 手动缩放 
假定你已经预配了 Standard_V2 应用程序网关，并手动将缩放设置为整个月中 8 个实例。 在此期间，它会收到平均 88.8-Mbps 的数据传输。

应用程序网关成本采用上述定价方式计算如下：

1 个 CU 可以处理 2.22-Mbps 的吞吐量。

处理 88.8 Mbps 所需的 CU = 88.8 / 2.22 = 40 个 CU 

提前预配的 CU = 8（实例计数）x 10 = 80 

由于 80（预留容量）大于 40（所需容量），因此无需额外 CU。 

固定价格 = 0.246 美元 x 730（小时）= 179.58 美元

可变成本 = 0.008 美元 x 8（实例单位）x 10（容量单位）x 730（小时）= 467.2 美元

总成本 = 179.58 美元 + 467.2 美元 = 646.78 美元

![手动缩放图 1。](./media/pricing/manual-scale-1.png)

### <a name="example-1-b--manual-scaling-with-traffic-going-beyond-provisioned-capacity"></a>示例 1 (b) – 对超出预配容量的流量进行手动缩放

假定你已经预配了 Standard_V2 应用程序网关，并手动将缩放设置为整个月中 3 个实例。 在此期间，它会收到平均 88.8-Mbps 的数据传输。

应用程序网关成本采用上述定价方式计算如下：

1 个 CU 可以处理 2.22 Mbps 的吞吐量。

处理 88.8 Mbps 所需的 CU = 88.8 / 2.22 = 40 

提前预配的 CU = 3（实例计数）x 10 = 30 

由于 40（所需容量）大于 30（预留容量），因此需要额外的 CU。
额外使用的 CU 数将取决于可供每个实例使用的可用容量。

如果在 3 个预留实例内有等同于增加 10 个 CU 的处理容量可供使用。

固定价格 = 0.246 美元 x 730（小时）= 179.58 美元

可变成本 = 0.008 美元 x（3（实例单位）x 10（容量单位）+ 10（额外容量单位））x 730（小时）= 233.6 美元

总成本 = 179.58 美元 + 233.6 美元 = 413.18 美元

但是，如果在 3 个预留实例内有等同于只增加比如说 7 个 CU 的处理容量可供使用。
在这种情况下，应用程序网关资源就会缩减，并且有可能会导致增加延迟或请求被删除。

固定价格 = 0.246 美元 x 730（小时）= 179.58 美元

可变成本 = 0.008 美元 x（3（实例单位）x 10（容量单位）+ 7（额外容量单位））x 730（小时）= 216.08 美元

总成本 = 179.58 美元 + 216.08 美元 = 395.66 美元


![手动缩放图 2。](./media/pricing/manual-scale-2.png)

> [!NOTE]
> 如果进行手动缩放，那么，任何超出预留实例最大处理容量的额外请求都可能会对应用程序的可用性造成影响。 在高负载的情况下，根据配置和传入请求类型的不同，预留实例或许能够提供 10 个以上容量单位的处理能力。 但还是建议根据流量需求来预配实例数。

### <a name="example-2--waf_v2-instance-with-autoscaling"></a>示例2 – 使用自动缩放的 WAF_V2 实例

假定你已经预配了启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为 6。 请求负载已经导致 WAF 实例在整个月当中横向扩展并使用了 65 个容量单位（横向扩展出了 5个容量单位，同时保留了 60 个单位）。
应用程序网关成本采用上述定价方式计算如下：

每月价格估算基于每个月使用 730 小时。

固定价格 = 0.443 美元 x 730（小时）= 323.39 美元

可变成本 = 0.0144 美元 x 65（容量单位）x 730（小时）= 683.28 美元

总成本 = 323.39 美元 + 683.28 美元 = 1006.67 美元

![自动缩放图 2。](./media/pricing/auto-scale-1.png)

> [!NOTE]
> 针对应用程序网关所观察的实际流量不太可能具有这种持续的流量模式，并且在应用程序网关上观察的负载会根据实际使用情况发生波动。

### <a name="example-3-a--waf_v2-instance-with-autoscaling-and-0-min-scale-config"></a>示例 3 (a) - 具有自动缩放并且最小规模配置为 0 的 WAF_V2 实例

假定你已经预配了启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为 0。 WAF 上的请求负载为最小值，但在整个月份当中持续每小时出现一次。 该负载低于一个容量单位的容量。
应用程序网关成本采用上述定价方式计算如下：

每月价格估算基于每个月使用 730 小时。

固定价格 = 0.443 美元 x 730（小时）= 323.39 美元

可变成本 = 0.0144 美元 x 1（容量单位）x 730（小时）= 10.512 美元

总成本 = 323.39 美元 + 10.512 美元 = 333.902 美元

### <a name="example-3-b--waf_v2-instance-with-autoscaling-with-0-min-instance-count"></a>示例 3 (b) – 具有自动缩放并且最小实例计数为 0 的 WAF_V2 实例

假定你已经预配了启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为 0。 但是，整个月中定向到该 WAF 实例的流量为 0。
应用程序网关成本采用上述定价方式计算如下：

固定价格 = 0.443 美元 x 730（小时）= 323.39 美元

可变成本 = 0.0144 美元 x 0（容量单位）x 730（小时）= 0 美元

总成本 = 323.39 美元 + 0 美元 = 323.39 美元

### <a name="example-3-c--waf_v2-instance-with-manual-scaling-set-to-1-instance"></a>示例 3 (C) – 手动缩放设置为 1 个实例的 WAF_V2 实例

假定你已经预配了 WAF_V2 并将其设置为将整个月可接受的最小实例数手动缩放为 1。 但是，整个月中定向到该 WAF 的流量为 0。
应用程序网关成本采用上述定价方式计算如下：

每月价格估算基于每个月使用 730 小时。

固定价格 = 0.443 美元 x 730（小时）= 323.39 美元

可变成本 = 0.0144 美元 x 1（实例单位）x 10（容量单位）x 730（小时）= 105.12 美元

总成本 = 323.39 美元 + 105.12 美元 = 428.51 美元

### <a name="example-4--waf_v2-with-autoscaling-capacity-unit-calculations"></a>示例 4 – 具有自动缩放和容量单位计算的 WAF_V2

假定你已经预配了启用了自动缩放的 WAF_V2，并将整个月份的最小实例计数设置为 0。 在这段时间内，它每秒接收 25 个新 TLS 连接，平均数据传输为 8.88 Mbps。
应用程序网关成本采用上述定价方式计算如下：

每月价格估算基于每个月使用 730 小时。

固定价格 = 0.443 美元 x 730（小时）= 323.39 美元

可变成本 = 0.0144 美元 x 730（小时）x {Max (25/50, 8.88/2.22) } = 23.36 美元（处理 8.88 Mbps 需要 4 个容量单位）

总成本 = 323.39 美元 + 23.36 美元 = 346.75 美元

### <a name="example-5-a--standard_v2-with-autoscaling-time-based-calculations"></a>示例 5 (a) - 具有自动缩放并基于时间计算的 Standard_V2

假定你已经预配启用了自动缩放的 standard_V2，并将最小实例计数设置为0，并且此应用程序网关处于活动状态 2 小时了。
在第一个小时内，它接收可由 10 个容量单位处理的流量，在第二个小时内，它接收需要 20 个容量单位来处理负载的流量。
应用程序网关成本采用上述定价方式计算如下：

固定价格 = 0.246 美元 x 2（小时）= 0.492 美元

可变成本 = 0.008 美元 x 10（容量单位）x 1（小时）+ 0.008 美元 x 20（容量单位）x 1（小时）= 0.24 美元

总成本 = 0.492 美元 + 0.24 美元 = 0.732 美元


## <a name="monitoring-billed-usage"></a>监视计费使用情况

可以在“监视”部分下查看作为应用程序网关指标组成部分的不同参数（计算单位、吞吐量和永久性连接）以及所使用的容量单位的消耗量。

![指标部分的图。](./media/pricing/metrics-1.png)

### <a name="useful-metrics-for-cost-estimation"></a>用于成本估算的有用指标

* 当前容量单位

    为了在三个参数（当前连接、吞吐量和计算单位）之间对流量进行负载平衡而消耗的容量单元的计数

* 固定的可计费容量单位

    在应用程序网关配置中，根据最小实例计数设置（1 个实例转换为 10 个容量单位）保持预配状态的容量单位的最小数目。

* 估计的计费容量单位

    估计的计费容量单位表示估计账单费用时所使用的容量单位的数目。 该值的计算取决于“当前容量单位”（对流量进行负载均衡所需的容量单位）和“固定的可计费容量单位”（始终预配的最小容量单位）这两项中哪个项的值更大。

还可以使用更多指标（如吞吐量、当前连接和计算单位）来了解瓶颈并估算所需容量单位数。 [应用程序网关指标](application-gateway-metrics.md)提供了详细信息

#### <a name="example---estimating-capacity-units-being-utilized"></a>示例 - 估算所使用的容量单位

观察到的指标：

* 计算单位 = 17.38
* 吞吐量 = 1.37 M 字节/秒 - 10.96 Mbps
* 当前连接数 = 123.08k
* 计算出的容量单位 = max(17.38, 10.96/2.22, 123.08k/2500) = 49.232

在指标中观察到的容量单位 = 49.23

## <a name="next-steps"></a>后续步骤

请参阅以下文章，以详细了解 Azure 应用程序网关中的定价方式：

* [Azure 应用程序网关定价页](https://azure.microsoft.com/pricing/details/application-gateway/)
* [Azure 应用程序网关定价计算器](https://azure.microsoft.com/pricing/calculator/?service=application-gateway)
