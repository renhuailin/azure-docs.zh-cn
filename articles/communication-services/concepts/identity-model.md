---
title: 标识模型
titleSuffix: An Azure Communication Services concept
description: 了解标识和访问令牌
author: tomaschladek
manager: nmurav
services: azure-communication-services
ms.author: tchladek
ms.date: 06/30/2021
ms.topic: conceptual
ms.service: azure-communication-services
ms.subservice: identity
ms.openlocfilehash: e19ea511a74f95e3c3c9877226751c1933879c46
ms.sourcegitcommit: f6e2ea5571e35b9ed3a79a22485eba4d20ae36cc
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/24/2021
ms.locfileid: "128671956"
---
# <a name="identity-model"></a>标识模型

Azure 通信服务是一种“标识不可知”的服务。 这种设计提供诸多优势：

- 重复使用标识管理系统中的现有标识
- 为集成方案提供灵活性
- 在 Azure 通信服务中保持标识的私密性

你将保留业务案例所需的映射关系，而不是在系统中复制信息。 例如，可对标识进行 1:1、1:N、N:1、N:M 的映射。 电话号码、用户、设备、应用程序和 GUID 等外部标识符不可用于 Azure 通信服务中的标识。 为 Azure 通信服务标识生成的访问令牌用于访问聊天或通话等基元。

## <a name="identity"></a>标识

可以使用 Azure 通信服务标识库来创建标识。 标识充当对话中的标识符。 它用于创建访问令牌。 同一个标识可以跨多个设备参与同时进行的多个会话。 一个标识可以同时有多个活动的访问令牌。

删除标识、资源或订阅会使其所有访问令牌失效。 此操作还会删除为标识存储的所有数据。 已删除的标识无法创建新访问令牌或访问以前存储的数据（例如聊天消息）。

不会按你现有的标识数量收费， 而会按基元的使用情况收费。 标识数量不一定会限制将应用程序的标识映射到 Azure 通信服务标识的方式。

与映射的自由相伴的是隐私保护责任。 如果某个用户希望从你的系统中被删除，则你需要删除与该用户关联的所有标识。

Azure 通信服务不会为匿名用户提供特殊标识。 它不保留用户与标识之间的映射，也不能确定某个标识是否是匿名的。 可以设计标识概念来满足需求。 建议为每个应用程序中的每个匿名用户创建一个新标识。

具有有效访问令牌的任何人都可以访问当前标识内容。 例如，用户可以访问他们发送的聊天消息。 仅限于在访问令牌的作用范围内进行访问。 有关详细信息，请参阅本文中的[访问令牌](#access-tokens)部分。

### <a name="identity-mapping"></a>标识映射

Azure 通信服务不复制 Azure 标识管理系统的功能。 它不会为客户提供使用客户特定的标识的方式。 例如，客户无法使用电话号码或电子邮件地址。 Azure 通信服务提供唯一的标识符。 可将这些唯一标识符分配到应用程序的标识。 Azure 通信服务不会存储任何类型的可能透露用户真实身份的信息。

若要避免在系统中复制信息，请规划好如何将标识域中的用户映射到 Azure 通信服务标识。 可以遵循任何一种模式。 例如，可以使用 1:1、1:N、N:1 或 M:N。 确定是要将单个用户映射到单个标识还是多个标识。

创建新标识后，存储该标识到一个或多个应用程序用户的映射。 由于标识需要通过访问令牌来使用基元，因此，应用程序的一个或多个用户需要知道该标识。

如果使用关系数据库存储用户信息，则可以根据映射方案调整设计。 对于采用 1:1 或 N:1 映射的方案，建议在表中添加一个 `CommunicationServicesId` 列来存储 Azure 通信服务标识。 在使用 1:N 或 N:M 关系的方案中，可以考虑在关系数据库中创建一个单独的表。

## <a name="access-tokens"></a>访问令牌

访问令牌是一种 JSON Web 令牌 (JWT)，可用于获取对 Azure 通信服务基元的访问权限。 颁发的访问令牌具有完整性保护。 也就是说，颁发该令牌后不能更改其声明。 因此，手动更改标识、过期时间或范围等属性会使访问令牌失效。 如果通过已失效的令牌使用基元，将拒绝访问基元。

访问令牌的属性是：
* 标识。
* Expiration。
* 范围。

访问令牌的有效期始终是 24 小时。 过期后，访问令牌将会失效，不可用于访问任何基元。

标识需要通过某种方式从服务器端服务请求新的访问令牌。 *scope* 参数定义一组可用的非空基元。 Azure 通信服务支持以下访问令牌范围。

|名称|说明|
|---|---|
|聊天|  授予加入聊天的能力|
|VoIP|  授予调用标识和电话号码的能力|


若要在访问令牌过期之前将其吊销，请使用 Azure 通信服务标识库。 令牌吊销不是立即生效的。 传播此操作最多需要 15 分钟。 删除标识、资源或订阅会吊销所有访问令牌。

若要消除用户访问特定功能的能力，请吊销所有访问令牌。 然后颁发具有一组受限程度更高的范围的新访问令牌。

在 Azure 通信服务中，轮换访问密钥会吊销使用先前的访问密钥创建的所有活动访问令牌。 所有标识都会失去对 Azure 通信服务的访问权限，并且必须颁发新的访问令牌。

建议在服务器端服务而不是客户端应用程序中颁发访问令牌。 原因是颁发访问令牌需要访问密钥或托管标识。 出于安全原因，建议不要与客户端应用程序共享访问密钥。

客户端应用程序应使用可对客户端进行身份验证的受信任服务终结点。 该终结点应代表客户端颁发访问令牌。 有关详细信息，请参阅[客户端和服务器体系结构](./client-and-server-architecture.md)。

如果在后备存储中缓存访问令牌，我们建议使用加密。 访问令牌属于敏感数据。 如果不受保护，访问令牌可能会被用于恶意活动。 拥有访问令牌的用户可以启动 SDK 并访问 API。 只能根据访问令牌的作用范围限制可访问的 API。 建议颁发仅具有必需范围的访问令牌。

## <a name="next-steps"></a>后续步骤

* 有关访问令牌管理的简介，请参阅[创建和管理访问令牌](../quickstarts/access-tokens.md)。
* 有关身份验证的简介，请参阅对 [Azure 通信服务进行身份验证](./authentication.md)。
* 有关数据驻留和隐私的简介，请参阅[区域可用性和数据驻留](./privacy.md)。
* 若要了解如何快速创建用于测试的标识，请参阅[快速创建标识快速入门](../quickstarts/identity/quick-create-identity.md)。
