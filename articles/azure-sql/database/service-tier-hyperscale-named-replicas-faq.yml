### YamlMime:FAQ
metadata:
  title: Azure SQL 数据库超大规模命名副本常见问题解答
  description: 对客户关于“超大规模”服务层级命名副本中 SQL 数据库中的数据库提出的常见问题的回答
  services: sql-database
  ms.service: sql-database
  ms.subservice: 
  ms.custom: 
  ms.devlang: 
  ms.topic: conceptual
  author: yorek
  ms.author: damauri
  ms.reviewer: 
  ms.date: 06/09/2021
  ms.openlocfilehash: 53dd0035a9ee973b68b7a1f795e500775e226e3f
  ms.sourcegitcommit: 285d5c48a03fcda7c27828236edb079f39aaaebf
  ms.translationtype: HT
  ms.contentlocale: zh-CN
  ms.lasthandoff: 07/02/2021
  ms.locfileid: "113233440"
title: Azure SQL 数据库超大规模命名副本常见问题解答
summary: "[!INCLUDE[appliesto-sqldb](../includes/appliesto-sqldb.md)]\n\n本文就客户对 Azure SQL 数据库“超大规模”服务层级中的数据库（在本常见问题解答的剩余部分简称为“超大规模”）提出的常见问题做出回答。 本文介绍“超大规模”支持的方案，以及与“超大规模”兼容的功能。\n\n- 本常见问题解答适用于对“超大规模”服务层级命名副本有基本了解并希望其具体问题得到解答的读者。\n- 有关“超大规模”命名副本的完整信息，请参阅[超大规模副本命名副本](service-tier-hyperscale-replicas.md#named-replica-in-preview)。 \n"
sections:
- name: 一般问题
  questions:
  - question: >
      命名副本能否用作故障转移目标？
    answer: >
      不能，命名副本不能用作故障转移目标。 此目的请使用 HA 副本。
  - question: >
      如何在命名副本之间分配只读工作负载？
    answer: >
      由于每个命名副本可能具有不同的服务级别目标，因此可用于不同的用例，因而没有内置方法将发送到主要副本的只读流量定向到相关的命名副本。 例如，你可能有八个命名副本，并且可能只想将 OLTP 工作负载定向到命名副本 1 到 4，而所有 Power BI 分析工作负载将使用命名副本 5 和 6，数据科学工作负载将使用副本 7 和 8. 根据你使用的工具或编程语言，分发此类工作负载的策略可能会有所不同。 创建工作负载路由解决方案以允许 REST 后端横向扩展的一个示例如下：[OLTP 横向扩展示例](https://github.com/Azure-Samples/azure-sql-db-named-replica-oltp-scaleout)。
  - question: >
      命名副本是否可以位于与主要副本不同的区域？
    answer: >
      不能，由于命名副本使用主副本的同一页面服务器，所以它们必须位于相同的区域。
  - question: >
      命名副本是否会影响主要副本的可用性或性能？
    answer: >
      命名副本不会影响主要副本的可用性。 通常，命名副本不太可能影响主要副本的性能，但如果运行密集型工作负载，则可能会发生此情况。 与 HA 副本一样，命名副本通过事务日志服务与主副本保持同步。 如果命名副本出于任何原因无法以足够快的速度使用事务日志，它将开始请求主要副本减慢（限制）其日志生成，以便它能够跟上进度。 尽管此行为不会影响主服务器的可用性，但会影响其性能。 若要避免这种情况，请确保命名副本有足够的可用资源（主要是 CPU）以便它们可以无延迟地处理事务日志。 例如，如果主服务器正在处理大量数据更改，建议命名副本至少具有与主服务器相同的服务级别目标，以避免副本上的 CPU 出现瓶颈，从而迫使主要副本减慢速度。
  - question: >
      如果主要副本（例如由于计划内维护）不可用，命名副本会发生什么情况？
    answer: >
      命名副本仍可照常进行只读访问。
  - question: >
      如何验证我是否已使用 SQL Server Management Studio (SSMS) 或其他客户端工具成功连接到次要计算副本？
    answer: >
      可执行以下 T-SQL 查询：


      ```sql

      SELECT @@SERVERNAME, DB_NAME(), DATABASEPROPERTYEX(DB_NAME(), 'Updateability');

      ```


      如果已连接到只读辅助副本，则结果为 `READ_ONLY`；如果已连接到主要副本，则结果为 `READ_WRITE`。 数据库上下文必须设置为“超大规模”数据库的名称，而不是数据库 `master` 的名称。
  - question: >
      能否在次要计算副本上创建任何对象或索引？
    answer: >
      否。 “超大规模”数据库有共享存储，这表示所有计算副本会看到相同的表格、索引和视图。 如果要使次要副本上的额外索引得到读取优化，必须在主要副本上添加索引。


      你仍然可以创建和使用临时表来存储临时数据。
  - question: >
      主要和次要计算副本之间的延迟是多少？
    answer: >
      从在主要副本上提交事务的时间开始算起，到该事务在次要副本上可读的时间为止，数据延迟取决于当前日志生成速率、事务大小、副本上的负载以及其他因素。 小型事务的典型数据延迟为数十毫秒，但数据延迟没有上限。 给定次要副本上的数据始终在事务上保持一致。 但在给定的时间点，不同次要副本的数据延迟可能不同。 需要立即读取已提交数据的工作负载应在主要副本上运行。
  - question: >
      如何提高命名副本的可用性？
    answer: >
      默认情况下，命名副本没有任何 HA 副本。 但是，由于它们的行为类似于常规（只读）Azure SQL 数据库，因此它们可以受益于 HA 副本提供的[更高 SLA](https://azure.microsoft.com/support/legal/sla/azure-sql-database/)。 若要设置 HA 副本数，可结合使用 `--ha-replicas` 和 [AZ CLI](/cli/azure/sql/db/replica?view=azure-cli-latest#az_sql_db_replica_create)或 `--HighAvailabilityReplicaCount` 和 [PowerShell](/powershell/module/az.sql/set-azsqldatabase)或通过 `highAvailabilityReplicaCount` 属性和 [REST API](/rest/api/sql/2021-02-01-preview/databases/create-or-update)。

      可以在创建命名副本期间设置 HA 副本数，并且可在创建命名副本后随时更改（仅通过 AZ CLI、PowerShell 或 REST API）。 命名副本的 HA 副本定价与常规数据库的 HA 副本相同。
additionalContent: "\n## <a name=\"next-steps\"></a>后续步骤\n\n有关“超大规模”服务层级的详细信息，请参阅[“超大规模”服务层级](service-tier-hyperscale.md)。\n有关超大规模副本的详细信息，请参阅[超大规模副本](service-tier-hyperscale-replicas.md)。"
