---
title: 配置管理员同意工作流
titleSuffix: Azure AD
description: 了解如何为最终用户配置一种请求访问需要管理员同意的应用程序的方式。
services: active-directory
author: davidmu1
manager: CelesteDG
ms.service: active-directory
ms.subservice: app-mgmt
ms.workload: identity
ms.topic: how-to
ms.date: 10/06/2021
ms.author: davidmu
ms.reviewer: ergreenl
ms.collection: M365-identity-device-management
ms.openlocfilehash: 07254d54d535616aa3a6b1c17a2b1b81d8fe16bb
ms.sourcegitcommit: e82ce0be68dabf98aa33052afb12f205a203d12d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/07/2021
ms.locfileid: "129659196"
---
# <a name="configure-the-admin-consent-workflow-in-azure-active-directory"></a>在 Azure Active Directory 中配置管理员同意工作流

本文介绍如何启用管理员同意工作流功能，最终用户可通过此功能请求访问需要管理员同意的应用程序。

如果没有管理员同意工作流，已禁用用户同意的租户中的用户在尝试访问任何需要组织数据访问权限的应用时将被阻止。 用户将看到一条常规错误消息，指出他们无权访问该应用，应请求管理员帮助。 但用户往往并不知道要与谁联系，因此他们可能会放弃访问，或者在应用程序中创建一个新的本地帐户。 即使管理员得到了通知，也不一定有一个简化的流程可帮助管理员授予访问权限并通知用户。
管理员同意工作流为管理员提供了一种安全的方式来授予需要管理员批准的应用程序访问权限。 如果用户尝试访问某个应用程序但无法提供同意，则他们可以发送请求以获取管理员的批准。 该请求将通过电子邮件发送到指定为审阅者的管理员。 审阅者对该请求采取操作，并向用户通知操作结果。

若要批准请求，审阅者必须是全局管理员、云应用程序管理员或应用程序管理员。 审阅者必须已拥有这些管理员角色之一；仅仅是将他们指定为审阅者并不能提升其特权。

## <a name="enable-the-admin-consent-workflow"></a>启用管理员同意工作流

若要启用管理员同意工作流并选择审阅者，请执行以下操作：

1. 以全局管理员身份登录到 [Azure 门户](https://portal.azure.com)。
2. 在左侧导航菜单的顶部单击“所有服务”。 此时会打开“Azure Active Directory 扩展”。
3. 在筛选器搜索框中键入“Azure Active Directory”，然后选择“Azure Active Directory”项 。
4. 在导航菜单中，单击“企业应用程序”。
5. 在“管理”下，选择“用户设置” 。
6. 在“管理员同意请求”中，将“用户可以请求管理员同意他们无法同意的应用”设置为“是”  。

   ![配置管理员同意工作流设置](media/configure-admin-consent-workflow/admin-consent-requests-settings.png)

7. 配置下列设置：

   * 选择要审阅管理员同意请求的用户。 从一组具有全局管理员、云应用程序管理员和应用程序管理员角色的用户中选择此工作流的审阅者。 请注意，必须先指定至少一个审阅者，然后才能启用工作流。
   * 所选用户将收到请求的电子邮件通知。 启用或禁用在发出请求时向审阅者发送电子邮件通知的功能。  
   * 所选用户将收到请求过期提醒。 启用或禁用当请求即将过期时向审阅者发送提醒电子邮件通知的功能。  
   * 同意请求将在(天数)后过期。 指定请求的有效期限。

8. 选择“保存”。 此功能最长可能需要在一小时后才会启用。

> [!NOTE]
> 可以通过修改“选择管理员同意请求审阅者”列表来添加或删除此工作流的审阅者。 请注意，此功能的当前限制是，审阅者依然能够审阅他们过去在被指定为审阅者期间发出的请求。

## <a name="how-users-request-admin-consent"></a>用户如何请求管理员同意

启用管理员同意工作流后，用户可以针对他们无权同意的应用程序请求管理员批准。 以下步骤描述请求批准时的用户体验。

1. 用户尝试登录到应用程序。

2. 此时将显示“需要批准”消息。 用户键入需要访问该应用的理由，然后选择“请求批准”。

   ![该屏幕截图显示“需要批准”对话框，可在其中请求批准。](media/configure-admin-consent-workflow/end-user-justification.png)

3. 随后会出现一条“已发送请求”消息，确认已将请求提交给管理员。如果用户发送多个请求，只有第一个请求才会提交给管理员。

   ![该屏幕截图显示“已发送请求”确认消息。](media/configure-admin-consent-workflow/end-user-sent-request.png)

4. 当用户的请求被批准、拒绝或阻止时，用户将收到电子邮件通知。

## <a name="review-and-take-action-on-admin-consent-requests"></a>审阅管理员同意请求并对其采取操作

若要审阅管理员同意请求并采取操作，请执行以下操作：

1. 以管理员同意工作流已注册审阅者之一的身份登录到 [Azure 门户](https://portal.azure.com)。
2. 在左侧导航菜单的顶部选择“所有服务”。 此时会打开“Azure Active Directory 扩展”。
3. 在筛选器搜索框中键入“Azure Active Directory”，然后选择“Azure Active Directory”项 。
4. 在导航菜单中，单击“企业应用程序”。
5. 在“活动”下，选择“管理员同意请求” 。

   > [!NOTE]
   > 审阅者只会看到在他们已指定为审阅者之后创建的管理员请求。

6. 选择被请求的应用程序。
7. 审阅有关该请求的详细信息：  

   * 若要查看访问权限请求者和请求原因，请选择“请求者”选项卡。
   * 若要查看该应用程序请求的权限，请选择“查看权限和同意”。

8. 评估该请求并采取适当的操作：

   * 批准请求。 若要批准请求，请向应用程序授予管理员同意。 批准请求后，系统会通知所有请求者已向其授予访问权限。 批准请求允许租户中的所有用户访问应用程序，用户分配另有限制除外。 
   * 拒绝请求。 若要拒绝请求，必须提供一个理由，该理由将提供给所有请求者。 拒绝请求后，系统会通知所有请求者已拒绝其访问该应用程序。 拒绝请求不会阻止用户将来再次请求对该应用的管理员同意。  
   * 阻止请求。 若要阻止请求，必须提供一个理由，该理由将提供给所有请求者。 阻止请求后，系统会通知所有请求者已拒绝其访问该应用程序。 阻止请求会在租户中为该应用程序创建一个处于禁用状态的服务主体对象。 用户将来无法请求对该应用程序的管理员同意。

## <a name="email-notifications"></a>电子邮件通知

如果已配置此功能，出现以下情况时，所有审阅者将收到电子邮件通知：

* 已创建新请求
* 请求已过期
* 请求即将过期  

出现以下情况时，请求者将收到电子邮件通知：

* 他们提交新的访问请求
* 他们的请求已过期
* 他们的请求已遭拒绝或阻止
* 他们的请求已获批准

## <a name="audit-logs"></a>审核日志

下表概述了可用于管理员同意工作流的方案和审核值。

|方案  |审核服务  |审核类别  |审核活动  |审核参与者  |审核日志限制  |
|---------|---------|---------|---------|---------|---------|
|管理员启用同意请求工作流        |访问评审           |UserManagement           |创建调控策略模板          |应用上下文            |目前无法查找用户上下文            |
|管理员禁用同意请求工作流       |访问评审           |UserManagement           |删除调控策略模板          |应用上下文            |目前无法查找用户上下文           |
|管理员更新同意工作流配置        |访问评审           |UserManagement           |更新调控策略模板          |应用上下文            |目前无法查找用户上下文           |
|最终用户创建对应用的管理员同意请求       |访问评审           |策略         |创建请求           |应用上下文            |目前无法查找用户上下文           |
|审阅者批准管理员同意请求       |访问评审           |UserManagement           |批准业务流中的所有请求          |应用上下文            |目前无法查找用户上下文或已授予管理员同意的应用 ID。           |
|审阅者拒绝管理员同意请求       |访问评审           |UserManagement           |批准业务流中的所有请求          |应用上下文            | 目前无法查找拒绝管理员同意请求的参与者的用户上下文          |

## <a name="faq"></a>FAQ

我已启用此工作流，但在测试功能时，为何未出现新的“需要批准”提示（这样我才能请求访问）？

启用该功能后，最终用户可能最多需要 60 分钟才能看到更新，但通常在数分钟内该功能就可提供给所有用户。

作为审阅者，我为何看不到所有待处理的请求？

审阅者只能看到他们在指定为审阅者之后创建的管理员请求。 如果你最近才被添加为审阅者，则看不到在被指派为审阅者之前创建的任何请求。

作为审阅者，我为何看到了对同一个应用程序的多个请求？
  
如果应用程序开发人员已将其应用配置为使用静态和动态同意来请求访问其最终用户的数据，则你会看到两个管理员同意请求。 一个请求代表静态权限，另一个请求代表动态权限。

作为请求者，我是否可以检查我的请求状态？  

不可以，请求者目前只能通过电子邮件通知获取状态更新。

审阅者是否可以选择性地为一部分用户批准应用程序？

如果你担心授予管理员同意后租户中的所有用户都可以使用该应用程序，我们建议你拒绝该请求。 然后手动授予管理员同意，方法是要求进行用户分配并将用户或组分配到该应用程序，以此限制对该应用程序的访问。 有关详细信息，请参阅[分配用户和组的方法](./assign-user-or-group-access-portal.md)。

我有一个需要用户分配的应用。系统要求分配到应用程序的用户请求管理员同意，而不能自行同意。为什么会这样？

当通过“需要用户分配”限制对应用程序的访问时，Azure AD 管理员需要同意应用程序所请求的所有权限。 

## <a name="next-steps"></a>后续步骤

有关许可应用程序的详细信息，请参阅 [Azure Active Directory 许可框架](../develop/consent-framework.md)。

[配置最终用户如何对应用程序表示同意](configure-user-consent.md)

[向应用程序授予租户范围的管理许可](grant-admin-consent.md)

[Microsoft 标识平台中的权限和许可](../develop/v2-permissions-and-consent.md)

[Microsoft Q&A 上的 Azure AD](/answers/topics/azure-active-directory.html)
