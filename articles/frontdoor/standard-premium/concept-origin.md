---
title: Azure Front Door 标准版/高级版中的源和源组
description: 本文介绍 Azure Front Door 配置中的源和源组。
services: frontdoor
author: duongau
ms.service: frontdoor
ms.topic: conceptual
ms.date: 02/18/2021
ms.author: duau
ms.openlocfilehash: 42c90d009aefb399e7635ec4a7cd09f884f3c51c
ms.sourcegitcommit: beff1803eeb28b60482560eee8967122653bc19c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/07/2021
ms.locfileid: "113437641"
---
# <a name="origin-and-origin-group-in-azure-front-door-standardpremium-preview"></a>Azure Front Door 标准版/高级版（预览版）中的源和源组

> [!Note]
> 本文档适用于 Azure Front Door 标准/高级（预览版）。 正在寻找有关 Azure Front Door 的信息？ 请查看[此处](../front-door-overview.md)。

本文介绍有关如何使用 Azure Front Door 标准版/高级版来部署 Web 应用程序的概念。 你还将了解 Azure Front Door 标准版/高级版配置中的源和源组 。

> [!IMPORTANT]
> Azure Front Door 标准版/高级版（预览版）目前以公共预览版提供。
> 此预览版在提供时没有附带服务级别协议，不建议将其用于生产工作负荷。 某些功能可能不受支持或者受限。
> 有关详细信息，请参阅 [Microsoft Azure 预览版补充使用条款](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)。

## <a name="origin"></a>源

Azure Front Door 标准版/高级版源是指为客户端请求提供服务的应用程序的主机名或公共 IP。 Azure Front Door 标准版/高级版既支持 Azure 源，也支持非 Azure 源，例如当应用程序托管在本地数据中心或由其他云提供程序托管时。 不得将源与数据库层或存储层混淆。 应将源视为应用程序后端的终结点。 如果要将源添加到 Azure Front Door 标准版/高级版源组，还必须添加以下信息：

* **源类型：** 想要添加的资源的类型。 Front Door 支持从应用服务、云服务或存储自动发现应用程序后端。 如果需要 Azure 后端（甚至非 Azure 后端）中的其他资源，请选择“自定义主机”。

    >[!IMPORTANT]
    >在配置期间，API 不会验证是否可从 Front Door 环境访问源。 请确保 Front Door 可访问你的源。

* **订阅和源主机名：** 如果未选择“自定义主机”作为后端主机类型，则需要选择相应的订阅以及相应的后端主机名，来选择你的后端。

* **源主机头：** 发送到后端的每个请求的主机头值。 有关详细信息，请查看[源主机头](#hostheader)。

* **优先级：** 如果想要使用主源来处理所有流量，可为不同的源分配优先级。 此外，如果主源或备份源不可用，则提供备份。 有关详细信息，请查看[优先级](#priority)。

* **权重：** 若要跨一组源均匀地或根据权重系数分布流量，可为不同的源分配权重。 有关详细信息，请查看[权重](#weighted)。

### <a name="origin-host-header"></a><a name = "hostheader"></a>源主机头

由 Azure Front Door 标准版/高级版转发到源的请求将包含一个主机头字段，源将使用该字段来检索目标资源。 此字段的值通常来自包含主机头和端口的源 URI。

例如，发送给 `www.contoso.com` 的请求将包含主机头 `www.contoso.com`。 如果使用 Azure 门户配置源，则此字段的默认值为后端的主机名。 如果源为 `contoso-westus.azurewebsites.net`，则在 Azure 门户中，源主机头的自动填充值为 `contoso-westus.azurewebsites.net`。 但是，如果在没有显式设置此字段的情况下使用 Azure 资源管理器模板或其他方法，Front Door 将发送传入的主机名作为主机头的值。 如果请求发送给 `www.contoso.com`，并且源为标头字段为空的 `contoso-westus.azurewebsites.net`，则 Front Door 会将主机头设为 `www.contoso.com`。

大多数应用后端（如 Azure Web 应用、Blob 存储和云服务）要求主机头与后端的域相匹配。 但是，路由到后端的前端主机将使用不同的主机名，例如 `www.contoso.net`。

如果源要求主标头匹配后端主机名，请确保后端主机头包含后端的主机名。

#### <a name="configuring-the-origin-host-header-for-the-origin"></a>配置源的源主机头

若要在源组部分中为源配置“源主机头”字段：

1. 打开 Front Door 资源并选择包含要配置的源的源组。

2. 添加源（如果尚未添加），或者编辑现有源。

3. 将“源主机头”字段设为自定义值，或将其留空。 将使用传入请求的主机名作为主机头值。

## <a name="origin-group"></a>源组

Azure Front Door 标准版/高级版中的源组是指为其应用程序接收类似流量的一组源。 换句话说，它是你在全球的应用程序实例的逻辑分组，这些实例可接收相同的流量，并以预期行为做出响应。 可在不同区域或在同一区域中部署这些源。 源可以全部处于主动/主动部署模式，或者定义为主动/被动配置。

源组定义应如何通过运行状况探测来评估源。 它还定义了如何在它们之间进行负载均衡。

### <a name="health-probes"></a>运行状况探测

Azure Front Door 标准版/高级版会向每个已配置的源发送定期 HTTP/HTTPS 探测请求。 探测请求可确定每个源的接近度和运行状况，以便对最终用户请求进行负载均衡。 源组的运行状况探测设置会定义我们如何轮询应用后端的运行状况状态。 以下设置可用于负载均衡配置：

* **路径**：用于源组中的所有源的探测请求的 URL。 例如，如果你的其中一个源是 `contoso-westus.azurewebsites.net`，并且路径设置为 /probe/test.aspx，则 Front Door 环境（假设协议设置为 HTTP）会将运行状况探测请求发送到 `http://contoso-westus.azurewebsites.net/probe/test.aspx`。

* **协议**：定义是否通过 HTTP 或 HTTPS 协议将运行状况探测请求从 Front Door 发送到源。

* **方法**：要用于发送运行状况探测的 HTTP 方法。 选项包括 GET 或 HEAD（默认）。
    > [!NOTE]
    > 为了降低后端的负载和成本，Front Door 建议将 HEAD 请求用于运行状况探测。

* **间隔（秒）** ：定义向源发送运行状况探测的频率，或每个 Front Door 环境发送探测的时间间隔。

    >[!NOTE]
    >为了更快地进行故障转移，请将时间间隔设为较小值。 但是值越低，你的后端接收到的运行状况探测请求量越多。 例如，如果将时间间隔设置为 30 秒（并且假设全球有 100 个 Front Door POP），则每个后端每分钟将收到约 200 个探测请求。

有关详细信息，请查看[运行状况探测](concept-health-probes.md)。

### <a name="load-balancing-settings"></a>负载均衡设置

源组的负载均衡设置定义我们评估运行状况探测的方式。 这些设置决定源是否正常运行。 它们还会检查如何在源组中的不同源之间对流量进行负载均衡。 以下设置可用于负载均衡配置：

* **样本大小：** 标识我们需要考虑采用多少个运行状况探测样本来进行源运行状况评估。

* **成功样本大小：** 定义在上述“样本大小”中，我们需要检查多少个成功样本，才能将源判定为正常。 例如，假定 Front Door 运行状况探测时间间隔为 30 秒，样本大小为 5，成功的样本大小为 3。 每次评估源的运行状况探测时，都将检查过去 150 秒内的最后五个样本 (5 x 30)。 至少需要三个成功的探测，才能将源声明为正常。

* **延迟敏感度（额外延迟）：** 定义是希望 Azure Front Door 标准版/高级版将请求发送到在延迟度量敏感度范围内的源，还是将请求转发到最近的后端。

有关详细信息，请查看[基于最少延迟的路由方法](#latency)。

## <a name="routing-methods"></a>路由方法

Azure Front Door 标准版/高级版支持使用各种不同的流量路由方法来确定将 HTTP/HTTPS 流量路由到不同的服务终结点的方式。 当客户端请求抵达 Front Door 时，将会应用配置的路由方法，以确保将请求转发到最佳的后端实例。 

Azure Front Door 标准版/高级版中提供了 4 种流量路由方法：

* **[延迟](#latency)：** 基于延迟的路由确保将请求发送到在敏感度范围内可接受的最低延迟的后端。 简单而言，将在考虑到网络延迟的情况下，将用户请求发送到“最靠近的”后端集。
* [优先级](#priority)：如果想要配置主后端来处理所有流量，可为后端分配优先级。 辅助后端可以作为备份，以防主后端变得不可用。
* [权重](#weighted)：想要在一组后端中分布流量时，可为后端分配权重。 可平均分配，也可根据权重系数进行分配。

所有 Azure Front Door 标准版/高级版配置包括监视后端运行状况以及自动执行的即时全局故障转移。 有关详细信息，请查看[后端监视](concept-health-probes.md)。 Front Door 可基于单一的路由方法运行。 但根据应用程序的需要，你还可结合多种路由方法来构建最佳路由拓扑。

### <a name="lowest-latencies-based-traffic-routing"></a><a name = "latency"></a>基于最低延迟的流量路由

通过在全球范围内的两个或更多位置部署后端，可将流量路由到“最靠近”最终用户的位置，从而提高应用程序的响应能力。 Front Door 配置默认的流量路由方法会将最终用户的请求转发到接收请求的 Front Door 环境中最靠近的后端。 此方法与 Azure Front Door 的任意广播体系结构相结合，可确保根据每个最终用户的位置，将其个性化的性能发挥到极致。

“最靠近”的后端不一定是地理距离最近的后端。 Front Door 通过测量网络延迟来确定最靠近的后端。

下面是整体决策流：

| 可用后端 | 优先级 | 延迟信号（基于运行状况探测） | 权重 |
|-------------| ----------- | ----------- | ----------- |
| 首先，选择已启用的且运行状况探测对其返回了正常状态 (200 OK) 的所有后端。 如果有 6 个后端 A、B、C、D、E 和 F，其中 C 的状态不正常，E 已禁用。 那么，可用后端的列表是 A、B、D 和 F。  | 接下来，在可用后端中选择优先级最高的后端。 如果后端 A、B 和 D 的优先级为 1，后端 F 的优先级为 2。 那么，选择的后端将是 A、B 和 D。| 选择在延迟范围内的后端（最小延迟，根据以毫秒为单位指定的延迟敏感度确定）。 如果后端 A、B 和 D 与请求抵达的 Front Door 环境之间的通信延迟分别是 15 毫秒、30 毫秒和 60 毫秒，延迟敏感度为 30 毫秒，那么，最低延迟池由后端 A 和 B 构成，因为 D 与最靠近的后端（即 A）之间的延迟差超过了 30 毫秒。 | 最后，Front Door 将会根据指定的权重比，在最终选择的后端池之间轮循流量。 假设后端 A 的权重为 5，后端 B 的权重为 8，则流量将按 5:8 的比在后端 A 与 B 之间分配。 |

>[!NOTE]
> 默认情况下，延迟敏感度属性设置为 0 毫秒，即，始终将请求转发到最快的可用后端。

### <a name="priority-based-traffic-routing"></a><a name = "priority"></a>基于优先级的流量路由

组织往往会部署一个或多个备份服务来防范主服务发生故障，从而确保其服务的高可用性。 在整个行业中，此拓扑也称为“主动/后备”或“主动/被动”部署拓扑。 Azure 客户可以通过“优先级”流量路由方法来轻松实现此故障转移模式。

默认的 Front Door 包含后端的均等优先级列表。 默认情况下，Front Door 只将流量发送到最高优先级后端（优先级值最小），即主要后端集。 如果主要后端不可用，则 Front Door 会将流量路由到辅助后端集（优先级值倒数第二小）。 如果主要后端和辅助后端都不可用，流量将转到第三个后端集，依此类推。 后端可用性基于配置的状态（已启用或已禁用），持续的后端运行状况由运行状况探测确定。

#### <a name="configuring-priority-for-backends"></a>配置后端的优先级

Front Door 配置的后端池内的每个后端都有一个名为“优先级”的属性，它可以是介于 1 和 5 之间的数字。 在 Azure Front Door 中，可以使用此属性为每个后端显式配置后端优先级。 此属性是介于 1 和 5 之间的值。 值越小，优先级越高。 后端可以共享优先级值。

### <a name="weighted-traffic-routing-method"></a><a name = "weighted"></a>加权流量路由方法
使用“加权”流量路由方法可以均匀分布流量，或使用预定义的权重。

在加权流量路由方法中，需将一个权重分配到后端池的 Front Door 配置中的每个后端。 该权重是从 1 到 1000 的整数。 此参数使用默认权重“50”。

在延迟敏感度可接受的可用后端列表中，流量将按指定的权重比以轮循机制分配。 如果延迟敏感度设置为 0 毫秒，则除非存在两个具有相同网络延迟的后端，否则此属性不会生效。 

加权方法可以实现一些有用的方案：

* 渐进式应用程序升级：分配要路由到新后端的流量百分比，并逐渐将流量按比例路由到其他后端。
* **将应用程序迁移到 Azure**：创建包含 Azure 后端和外部后端的后端池。 调整后端权重，以优先选择新的后端。 可以采用渐进式的设置方式：一开始禁用新后端，然后为它们分配最低权重，再慢慢地将权重提高到接收最多流量的级别。 最后，禁用优先级最低的后端，并从池中删除它们。  
* **执行云喷发式部署以增加容量**：通过将本地部署放在 Front Door 的后面，快速将其扩展到云中。 需要在云中获取更多的容量时，可以添加或启用更多后端，并指定哪部分流量将流向每个后端。

## <a name="next-steps"></a>后续步骤

了解如何[创建 Front Door 标准版/高级版](create-front-door-portal.md)
