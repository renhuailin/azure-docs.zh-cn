### YamlMime:FAQ
metadata:
  title: Azure Front Door - 常见问题解答
  description: 本页提供有关 Azure Front Door 的常见问题解答
  services: frontdoor
  documentationcenter: ''
  author: duongau
  ms.service: frontdoor
  ms.devlang: na
  ms.topic: article
  ms.tgt_pltfrm: na
  ms.workload: infrastructure-services
  ms.date: 09/14/2021
  ms.author: duau
  ms.openlocfilehash: a0683e48e0e64ef49d2c76f41642c496b78c58c9
  ms.sourcegitcommit: 87de14fe9fdee75ea64f30ebb516cf7edad0cf87
  ms.translationtype: HT
  ms.contentlocale: zh-CN
  ms.lasthandoff: 10/01/2021
  ms.locfileid: "129363866"
title: Azure Front Door 常见问题解答
summary: >
  本文解答有关 Azure Front Door 特性和功能的常见问题。 如果本文未能涵盖你的问题，欢迎通过以下渠道联系我们（以升序排列）：


  1. 本文评论部分。

  2. [Azure Front Door UserVoice](https://feedback.azure.com/forums/217313-networking?category_id=345025)。

  3. Microsoft 支持：若要创建新的支持请求，请在 Azure 门户中的“帮助”选项卡上，选择“帮助和支持”按钮，然后选择“新建支持请求”。
sections:
- name: 常规
  questions:
  - question: >
      什么是 Azure Front Door？
    answer: >
      Azure Front Door 是一项应用程序分发网络 (ADN) 即服务，为应用程序提供各种第 7 层负载均衡功能。 它提供动态站点加速 (DSA)，还提供具有准实时故障转移能力的全球负载均衡。 它是高度可用且可缩放的服务，由 Azure 完全托管。
  - question: >
      Azure Front Door 支持哪些功能？
    answer: >
      Azure Front Door 支持动态站点加速 (DSA)、TLS/SSL 卸载和端到端 TLS、Web 应用程序防火墙、基于 Cookie 的会话亲和性、基于 URL 路径的路由、免费证书和多个域管理等。 有关支持的功能的完整列表，请参阅 [Azure Front Door 概述](front-door-overview.md)。
  - question: >
      Azure Front Door 和 Azure 应用程序网关有什么差别？
    answer: >
      Front Door 和应用程序网关都是第 7 层 (HTTP/HTTPS) 负载均衡器，两者的主要差别在于，Front Door 是全局服务，而应用程序网关是区域服务。 Front Door 可以在各区域中的不同缩放单元/群集/标记单元之间进行负载均衡，而应用程序网关可用于在缩放单元内部的 VM/容器等之间进行负载均衡。
  - question: >
      何时应在 Front Door 后面部署应用程序网关？
    answer: "为何应在 Front Door 后面使用应用程序网关的重要原因是：\n\n- Front Door 只能在全局级别执行基于路径的负载均衡，但如果用户要在其虚拟网络 (VNET) 中进一步对流量进行负载均衡，则应使用应用程序网关。\n- 由于 Front Door 不是在 VM/容器级别工作，因此无法执行连接排出。 但是，应用程序网关可用于执行连接排出。 \n- 在 Front Door 后面使用应用程序网关，用户可以实现 100% 的 TLS/SSL 卸载，并仅在其虚拟网络 (VNET) 内部路由 HTTP 请求。\n- Front Door 和应用程序网关都支持会话亲和性。 Front Door 可以将来自用户会话的后续流量定向到给定区域中的同一群集或后端，而应用程序网关可以将流量直接关联到群集中的同一服务器。  \n"
  - question: >
      是否可以在 Front Door 后面部署 Azure 负载均衡器？
    answer: >
      Azure Front Door 需要一个可将流量路由到的公共 VIP 或公用 DNS 名称。 在 Front Door 后面部署 Azure 负载均衡器是一个常见用例。
  - question: >
      Azure Front Door 支持哪些协议？
    answer: >
      Azure Front Door 支持 HTTP、HTTPS 和 HTTP/2。
  - question: >
      Azure Front Door 如何支持 HTTP/2？
    answer: >
      HTTP/2 协议支持仅适用于连接到 Azure Front Door 的客户端。 与后端池中后端的通信是通过 HTTP/1.1 进行的。 默认已启用 HTTP/2 支持。
  - question: >
      目前支持在后端池中添加哪些资源？
    answer: >
      后端池可以由存储、Web 应用、Kubernetes 实例或者已建立公共连接的任何其他自定义主机名组成。 Azure Front Door 要求通过公共 IP 或可公开解析的 DNS 主机名定义后端。 后端池的成员可以跨局部区域、地理区域，甚至在 Azure 外部，前提是它们已建立公共连接。
  - question: >
      该服务已在哪些区域推出？
    answer: "Azure Front Door 是一个全局服务，并不局限于任何特定的 Azure 区域。 创建 Front Door 时需要指定的唯一位置是资源组位置，这基本上指定了资源组元数据的存储位置。 Front Door 资源本身是作为全局资源创建的，其配置将全局部署到所有边缘位置。 \n"
  - question: >
      Azure Front Door 的边缘位置在哪儿？
    answer: >
      有关 Azure Front Door 边缘位置的完整列表，请参阅 [Azure Front Door 边缘位置](edge-locations-by-region.md)。
  - question: >
      Azure Front Door 是应用程序的专用部署还是在客户之间共享？
    answer: >
      Azure Front Door 是全球分布式多租户服务。 因此，Front Door 的基础结构在其所有客户之间共享。 但是，通过创建 Front Door 配置文件，可以定义应用程序所需的特定配置，并且对 Front Door 所做的更改不会影响其他 Front Door 配置。
  - question: >
      是否支持 HTTP 到 HTTPS 的重定向？
    answer: "是。 事实上，Azure Front Door 支持主机、路径、查询字符串重定向，以及一部分 URL 重定向。 详细了解 [URL 重定向](front-door-url-redirect.md)。 \n"
  - question: >
      按什么顺序处理路由规则？
    answer: >
      不对 Front Door 的路由进行排序，并根据最佳匹配选择特定的路由。 详细了解 [Front Door 如何匹配对路由规则的请求](front-door-route-matching.md)。
  - question: >
      如何锁定为仅限通过 Azure Front Door 访问我的后端？
    answer: "> [!NOTE]\n> 新的 SKU Front Door Premium 提供更多建议的方法来通过专用终结点锁定应用程序。 [详细了解专用终结点](./standard-premium/concept-private-link.md)\n\n若要将应用程序锁定为仅接受来自特定 Front Door 的流量，需要为后端设置 IP ACL，然后将后端的流量限制为 Front Door 发送的头“X-Azure-FDID”的特定值。 下面详细说明了这些步骤：\n\n- 为后端配置 IP ACL，以仅接受来自 Azure Front Door 后端 IP 地址空间和 Azure 基础结构服务的流量。 有关为后端配置 ACL 的信息，请参阅以下 IP 详细信息：\n \n    - 有关 Front Door 的 IPv4 后端 IP 地址范围，请参阅 [Azure IP 范围和服务标记](https://www.microsoft.com/download/details.aspx?id=56519)中的 AzureFrontDoor.Backend 部分，或者也可以使用[网络安全组](../virtual-network/network-security-groups-overview.md#security-rules)中的服务标记 AzureFrontDoor.Backend。\n    - 通过虚拟化主机 IP 地址 `168.63.129.16` 和 `169.254.169.254` 配置 Azure 的[基本基础结构服务](../virtual-network/network-security-groups-overview.md#azure-platform-considerations)\n\n    > [!WARNING]\n    > Front Door 的后端 IP 空间今后可能会更改，但在此之前，我们会确保与 [Azure IP 范围和服务标记](https://www.microsoft.com/download/details.aspx?id=56519)相集成。 我们建议你订阅 [Azure IP 范围和服务标记](https://www.microsoft.com/download/details.aspx?id=56519)，以随时了解任何更改或更新。\n\n- 在 Front Door 门户页的“概述”部分下查找 `Front Door ID` 值。 然后，可以使用该值对 Front Door 发送到后端的传入头“X-Azure-FDID”进行筛选，以确保只允许你自己的特定 Front Door 实例（因为上面的 IP 范围与其他客户的其他 Front Door 实例共享）。\n\n- 在后端 Web 服务器中应用规则筛选，以基于生成的“X-Azure-FDID”头值限制流量。 请注意，有些服务（如 Azure 应用服务）提供了[基于此头的筛选](../app-service/app-service-ip-restrictions.md#restrict-access-to-a-specific-azure-front-door-instance)功能，而无需更改应用程序或主机。\n\n  下面是 [Microsoft Internet Information Services (IIS)](https://www.iis.net/) 的示例：\n\n    ``` xml\n    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <configuration>\n        <system.webServer>\n            <rewrite>\n                <rules>\n                    <rule name=\"Filter_X-Azure-FDID\" patternSyntax=\"Wildcard\" stopProcessing=\"true\">\n                        <match url=\"*\" />\n                        <conditions>\n                            <add input=\"{HTTP_X_AZURE_FDID}\" pattern=\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\" negate=\"true\" />\n                        </conditions>\n                        <action type=\"AbortRequest\" />\n                    </rule>\n                </rules>\n            </rewrite>\n        </system.webServer>\n    </configuration>\n    ```\n    \n- Azure Front Door 还支持 AzureFrontDoor.Frontend 服务标记，该标记提供客户端在连接到 Front Door 时使用的 IP 地址的列表。 在你控制应该被允许连接到部署在 Azure Front Door 之后的服务的出站流量时，可使用 AzureFrontDoor.Frontend 服务标记。 Azure Front Door 还支持使用额外的服务标记 AzureFrontDoor.FirstParty 与其他 Azure 服务进行内部集成。 有关 Azure Front Door 服务标记用例的更多详细信息，请参阅[可用服务标记](../virtual-network/service-tags-overview.md#available-service-tags)。\n\n如果使用应用程序网关作为 Azure Front Door 的后端，则可以通过自定义 WAF 规则在 `X-Azure-FDID` 标头上进行检查。  有关详细信息，请参阅[在应用程序网关上创建和使用 Web 应用程序防火墙 v2 自定义规则](../web-application-firewall/ag/create-custom-waf-rules.md#example-7)。\n"
  - question: >
      任意播 IP 在 Front Door 的生存期内是否可能更改？
    answer: >
      Front Door 的前端任意播 IP 通常不会更改，在 Front Door 的生存期内可能保持静态。 但是，我们不能保证这一点。 敬请不要对 IP 有任何直接依赖。
  - question: >
      Azure Front Door 是否支持静态或专用 IP？
    answer: "否，Azure Front Door 目前不支持静态或专用前端任意播 IP。 \n"
  - question: >
      Azure Front Door 是否支持 x-forwarded-for 头？
    answer: "是，Azure Front Door 支持 X-Forwarded-For、X-Forwarded-Host 和 X-Forwarded-Proto 头。 对于 X-Forwarded-For，如果该头已存在，则 Front Door 会将客户端套接字 IP 追加到其中。 否则，它会添加该头，并在其中包含客户端套接字 IP 作为值。 对于 X-Forwarded-Host 和 X-Forwarded-Proto，将替代值。\n\n详细了解 [Front Door 支持的 HTTP 头](front-door-http-headers-protocol.md)。  \n"
  - question: >
      部署 Azure Front Door 需要多长时间？ 更新 Front Door 时，它是否仍可正常工作？
    answer: "在所有边缘位置全局部署大多数新的 Front Door 创建和更新需要大约 3 到 20 分钟时间。 \n\n> [!Note]  \n> 全局部署大多数自定义 TLS/SSL 证书更新需要数分钟到一小时。\n\n对路由或后端池等的任何更新是无缝的，完全不会导致停机（如果新配置正确）。 证书更新也是原子性的，不会造成任何中断，除非从“AFD 托管”切换到“使用你自己的证书”，反之亦然。\n"
- name: 配置
  questions:
  - question: >
      Azure Front Door 是否可以对虚拟网络内部的流量进行负载均衡或路由？
    answer: >
      Azure Front Door (AFD) 需要通过一个公共 IP 或可公开解析的 DNS 名称来路由流量。 因此，答案是所有 AFD 都能直接在虚拟网络中路由，但是在两者之间使用应用程序网关或 Azure 负载均衡器将解决此问题。
  - question: >
      Azure Front Door 有哪些超时设置和限制？
    answer: >
      了解文档中所述的所有 [Azure Front Door 的超时和限制](../azure-resource-manager/management/azure-subscription-service-limits.md#azure-front-door-service-limits)。
  - question: >
      将某个规则添加到 Front Door 规则引擎后，该规则在多久后生效？
    answer: "大多数规则引擎配置更新在 20 分钟内完成。 更新完成后，规则应该就会立即生效。 \n"
  - question: >
      能否在 Front Door 配置文件后配置 Azure CDN，反之亦然？
    answer: "不能同时配置 Azure Front Door 和 Azure CDN，因为这两个服务在响应请求时利用相同的 Azure 边缘站点。 \n"
- name: 性能
  questions:
  - question: >
      Azure Front Door 如何支持高可用性和可伸缩性？
    answer: >
      Azure Front Door 是全球分布式多租户平台，具有巨大的容量，可满足应用程序的可伸缩性需求。 Front Door 部署在 Microsoft 全球网络的边缘，提供全局负载均衡功能，可让你跨区域或不同的云故障转移整个应用程序甚至单个微服务。
- name: TLS 配置
  questions:
  - question: >
      Azure Front Door 支持哪些 TLS 版本？
    answer: >
      在 2019 年 9 月之后创建的所有 Front Door 配置文件使用 TLS 1.2 作为默认的最低版本。


      Front Door 支持 TLS 版本 1.0、1.1 和 1.2。 尚不支持 TLS 1.3。
  - question: >
      Azure Front Door 支持哪些证书？
    answer: >
      若要启用 HTTPS 协议以在 Front Door 自定义域上安全地传递内容，可以选择使用由 Azure Front Door 管理的证书，或使用自己的证书。

      Front Door 托管选项通过 Digicert 预配标准的 TLS/SSL 证书，并将其存储在 Front Door 的密钥保管库中。 如果你选择使用自己的证书，则可以从支持的 CA 加入证书，该证书可以是标准 TLS、扩展的验证证书，甚至通配符证书。 不支持自签名证书。 了解[如何为自定义域启用 HTTPS](./front-door-custom-domain-https.md)。
  - question: >
      Front Door 是否支持自动轮换证书？
    answer: >
      使用 Front Door 托管证书选项时，Front Door 会自动轮换证书。 如果你使用 Front Door 托管的证书并发现证书过期日期少于 60 天，请提交支持票证。

      </br>对于你自己的自定义 TLS/SSL 证书，请将机密版本设置为“最新”，以便 Azure Front Door 自动轮换到上传到 Key Vault 的最新机密版本。 部署新版本的证书/机密最多需要 24 小时。 如果将机密版本配置为特定版本，则需要将 Front Door 指向 Key Vault 中的正确证书版本。 确保 Front Door 的服务主体仍有权访问密钥保管库。 请参阅[如何授予对密钥保管库的访问权限](standard-premium/how-to-configure-https-custom-domain.md#grant-azure-front-door-access-to-your-key-vault)。 只要证书的使用者名称或使用者替换名称 (SAN) 不更改，Front Door 执行的这项已更新的证书推出操作就不会在生产过程中造成任何停机时间。
  - question: >
      Azure Front Door 支持哪些最新的加密套件？
    answer: "对于 TLS1.2，支持的加密套件如下： \n\n- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\n- TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n- TLS_DHE_RSA_WITH_AES_256_GCM_SHA384\n- TLS_DHE_RSA_WITH_AES_128_GCM_SHA256\n\n> [!NOTE]  \n> 对于 Windows 10 及更高版本，建议启用一个或全部两个 ECDHE 加密套件来增强安全性。 Windows 8.1、8 和 7 版本与这些 ECDHE 加密套件不兼容。 提供 DHE 加密套件是为了与这些操作系统兼容。\n\n在启用 TLS 1.0/1.1 的情况下使用自定义域时，支持以下加密套件：\n\n- TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256\n- TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384\n- TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n- TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\n- TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256\n- TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384\n- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256\n- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384\n- TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA\n- TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA\n- TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA\n- TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA\n- TLS_RSA_WITH_AES_256_GCM_SHA384\n- TLS_RSA_WITH_AES_128_GCM_SHA256\n- TLS_RSA_WITH_AES_256_CBC_SHA256\n- TLS_RSA_WITH_AES_128_CBC_SHA256\n- TLS_RSA_WITH_AES_256_CBC_SHA\n- TLS_RSA_WITH_AES_128_CBC_SHA\n- TLS_DHE_RSA_WITH_AES_128_GCM_SHA256\n- TLS_DHE_RSA_WITH_AES_256_GCM_SHA384\n"
  - question: >
      是否可以配置 TLS 策略来控制 TLS 协议版本？
    answer: >
      可以通过 Azure 门户或 [Azure REST API](/rest/api/frontdoorservice/frontdoor/frontdoors/createorupdate#minimumtlsversion) 在自定义域 HTTPS 设置中配置 Azure Front Door 中的最低 TLS 版本。 目前可以在 1.0 和 1.2 之间进行选择。
  - question: >
      是否可以将 Front Door 配置为仅支持特定的加密套件？
    answer: "否，不支持将 Front Door 配置为使用特定的加密套件。 但是，你可以从证书颁发机构（例如 Verisign、Entrust 或 Digicert）获得自己的自定义 TLS/SSL 证书，并在生成证书时在证书上标记特定的加密套件。 \n"
  - question: >
      Front Door 是否支持 OCSP 装订？
    answer: >
      是，默认情况下，Front Door 无需经过任何配置即可支持 OCSP 装订。
  - question: >
      Azure Front Door 是否也支持重新加密发往后端的流量？
    answer: >
      是的，Azure Front Door 支持 TLS/SSL 卸载和端到端 TLS，这会重新加密发往后端的流量。 事实上，由于与后端的连接是通过其公共 IP 进行的，因此建议你将 Front Door 配置为使用 HTTPS 作为转发协议。
  - question: >
      Front Door 是否支持在后端上使用自签名证书进行 HTTPS 连接？
    answer: >
      否，Front Door 不支持自签名证书，此项限制适用于以下两者：


      - 后端：将流量作为 HTTPS 或 HTTPS 运行状况探测转发时，或者在启用缓存的情况下为路由规则的来源填充缓存时，不能使用自签名证书。

      - 前端：使用自己的自定义 TLS/SSL 证书在自定义域上启用 HTTPS 时，不能使用自签名证书。
  - question: >
      发送到后端的 HTTPS 流量为何失败？
    answer: "与后端成功建立 HTTPS 连接（不管是出于转发运行状况探测还是转发请求的目的）后，有两个可能的原因会导致 HTTPS 流量失败：\n\n- 证书使用者名称不匹配：对于 HTTPS 连接，Front Door 预期后端会出示来自有效 CA 的证书，该证书中的使用者名称与后端主机名匹配。 例如，如果后端主机名设置为 `myapp-centralus.contosonews.net`，并且后端在 TLS 握手期间出示的证书的使用者名称中既没有 `myapp-centralus.contosonews.net` 也没有 `*myapp-centralus*.contosonews.net`，则 Front Door 将拒绝连接并导致错误。 \n    - 解决方法：对 Front Door 禁用证书使用者名称检查可以解决此错误，从合规的角度讲，我们不建议这样做。 此选项显示在 Azure 门户中的“设置”下以及在 API 中的 BackendPoolsSettings 下。\n- 后端宿主证书来自无效的 CA：在包含 Front Door 的后端上只能使用来自[有效证书颁发机构](https://ccadb-public.secure.force.com/microsoft/IncludedCACertificateReportForMSFT)的证书。 不允许来自内部 CA 的证书或自签名证书。 证书必须具有包含叶证书和中间证书的完整证书链，根 CA 必须是 [Microsoft 受信任 CA 列表](https://ccadb-public.secure.force.com/microsoft/IncludedCACertificateReportForMSFT)的一部分。 \n"
  - question: >
      是否可以对 Azure Front Door 使用客户端/相互身份验证？
    answer: >
      不知道。 尽管 Azure Front Door 支持 [RFC 5246](https://tools.ietf.org/html/rfc5246) 中的 TLS 1.2（引入了客户端/相互身份验证），但目前 Azure Front Door 并不支持客户端/相互身份验证。
- name: 计费
  questions:
  - question: >
      是否会对已禁用的 Azure Front Door 资源计费？
    answer: >
      Azure Front Door 资源（如 Front Door 配置文件、传递规则）在禁用时不计费。 WAF 策略和规则即使在禁用时也会计费。
- name: 诊断和日志记录
  questions:
  - question: >
      Azure Front Door 提供哪些类型的指标和日志？
    answer: >
      有关日志和其他诊断功能的信息，请参阅[监视 Front Door 的指标和日志](front-door-diagnostics.md)。
  - question: >
      什么是诊断日志的保留策略？
    answer: >
      诊断日志将发往客户存储帐户，客户可以根据偏好设置保留策略。 此外，可将诊断日志发送到事件中心或 Azure Monitor 日志。 有关详细信息，请参阅 [Azure Front Door 诊断](front-door-diagnostics.md)。
  - question: >
      如何获取 Azure Front Door 的审核日志？
    answer: "为 Azure Front Door 提供了审核日志。 在门户中，在 Front Door 的菜单边栏选项卡中单击“活动日志”即可访问审核日志。 \n"
  - question: >
      是否可对 Azure Front Door 设置警报？
    answer: "是，Azure Front Door 支持警报。 警报是针对指标配置的。 \n"
additionalContent: "\n## <a name=\"next-steps\"></a>后续步骤\n\n- 了解如何[创建 Front Door](quickstart-create-front-door.md)。\n- 了解 [Front Door 的工作原理](front-door-routing-architecture.md)。"
