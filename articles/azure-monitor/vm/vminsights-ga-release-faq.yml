### YamlMime:FAQ
metadata:
  title: VM 见解 (GA) 常见问题 | Microsoft Docs
  description: VM 见解是 Azure 中的一个解决方案，它合并了 Azure VM 操作系统的运行状况和性能监视、应用程序组件及其与其他资源的依赖关系的自动发现功能，并映射这些组件和资源之间的通信。 本文解答有关 GA 版本的常见问题。
  ms.topic: article
  author: bwren
  ms.author: bwren
  ms.date: 01/31/2020
  ms.service: azure-monitor
  ms.openlocfilehash: 230bac590e4506593cc0cb6cce0aba89ed289ad3
  ms.sourcegitcommit: 05dd6452632e00645ec0716a5943c7ac6c9bec7c
  ms.translationtype: HT
  ms.contentlocale: zh-CN
  ms.lasthandoff: 08/17/2021
  ms.locfileid: "122253861"
title: VM 见解正式发布 (GA) 常见问题
summary: 此正式发布版本 FAQ 介绍了我们在为 GA 做准备时在 2019 年第 4 季度和 2020 年第 1 季度所做的更改。
sections:
- name: 忽略
  questions:
  - question: >
      VM 见解更新
    answer: "我们于 2020 年 1 月（早于 GA 的公告）发布了新版本的 VM 见解。 现在，启用 VM 见解的客户将收到 GA 版本，但使用 2019 年第 4 季度或更早版本的 VM 见解的现有客户将收到升级提示。 如果你有跨多个工作区的大型部署，则此 FAQ 提供了大规模升级的指导。\n\n\n通过此次升级，VM 见解性能数据将存储在与[容器见解](../containers/container-insights-overview.md)相同的“InsightsMetrics”表中，这使你可以更轻松地查询这两个数据集。 你还可以存储更多种类的数据集，而之前使用的表无法做到这一点。 \n\n现在，我们的性能视图使用的是在 InsightsMetrics 表中存储的数据。  如果尚未完成在工作区中使用最新的 VMInsights 解决方案的升级，则图表将不再显示信息。  你可以从“入门”页面升级，如下所述。\n"
  - question: >
      有什么变化？
    answer: "我们发布了一个名为 VMInsights 的新解决方案，它包含更多数据收集功能，以及用于将此数据存储在 Log Analytics 工作区中的新位置。 \n\n过去，我们在你的工作区中启用了 ServiceMap 解决方案，并在 Log Analytics 工作区中设置了性能计数器，以将数据发送到“Perf”表。 此新解决方案会将数据发送到一个名为“InsightsMetrics”的表，该表也由容器见解使用。 此表架构使我们可以存储与“Perf”表格式不兼容的更多指标和服务数据集。\n\n我们更新了性能图表，以使用我们在“InsightsMetrics”表中存储的数据。 你可以升级以在“入门”页中使用“InsightsMetrics”表如下所示。\n"
  - question: >
      如何升级？
    answer: "Log Analytics 工作区升级到 VM 的最新 Azure Monitor 版本时，它会升级附加到该工作区的每个 VM 上的依赖项代理。 每个需要升级的 VM 都将在 Azure 门户中的 VM 见解的“入门”选项卡中进行标识。 选择升级 VM 时，会将该 VM 的工作区与附加到该工作区的任何其他 VM 一起升级。 可以选择单个 VM、多个 VM、资源组或订阅。 \n\n使用以下命令通过 PowerShell 升级工作区：\n\n```PowerShell\nSet-AzOperationalInsightsIntelligencePack -ResourceGroupName <resource-group-name> -WorkspaceName <workspace-name> -IntelligencePackName \"VMInsights\" -Enabled $True\n```\n"
  - question: >
      如果安装 VMInsights 解决方案，我应该如何处理工作区中的性能计数器？
    answer: "上一种启用 VM 见解的方法在工作区中使用了性能计数器。 当前版本将此数据存储在名为 `InsightsMetrics` 的表中。 如果不再需要使用这些性能计数器，可以选择在工作区中禁用它们。 \n\n>[!NOTE]\n>如果有在 `Perf` 表中引用这些计数器的警报规则，则需要对其进行更新以引用存储在 `InsightsMetrics` 表中的新数据。 请参阅我们的文档，了解可以使用的引用此表的示例日志查询。\n>\n\n如果决定保持性能计数器为启用状态，则将根据 `Perf`Log Analytics 定价[对 ](https://azure.microsoft.com/pricing/details/monitor/) 表中引入和存储的数据计费。\n"
  - question: >
      此更改如何影响我的警报规则？
    answer: >
      如果你创建了[日志警报](../alerts/alerts-unified-log.md)来查询针对工作区中启用的性能计数器的 `Perf` 表，则应更新这些规则以引用 `InsightsMetrics` 表。 本指南还适用于使用 `ServiceMapComputer_CL` 和 `ServiceMapProcess_CL` 的任何日志搜索规则，因为这些数据集将移动到 `VMComputer` 和 `VMProcess` 表。


      我们将更新此 FAQ 和我们的文档，以包含所收集数据集的示例日志搜索警报规则。
  - question: >
      此更改将如何影响我的账单？
    answer: >
      仍基于 Log Analytics 工作区中引入并保留的数据计费。


      我们收集的机器级别性能数据与存储在 `Perf` 表中的数据相同、大小相似，并且花费的金额大致相同。
  - question: >
      如果我只想使用服务映射，该怎么办？
    answer: "没有问题。 查看有关即将进行的更新的 VM 见解时，你将在 Azure 门户中看到提示。 发布后，你会收到一条提示，要求你更新为新版本。 如果你只想使用 [Maps](vminsights-maps.md) 功能，可以选择不升级并继续使用 VM 见解中的 Maps 功能和从工作区或仪表板磁贴访问的服务映射解决方案。\n\n如果选择手动启用工作区中的性能计数器，也许可以从 Azure Monitor 查看某些性能图表中的数据。 新解决方案发布后，我们将更新性能图表以查询存储在 `InsightsMetrics` 表中的数据。 如果要在这些图表中看到该表中的数据，则需要升级到新版本的 VM 见解。\n\n从 `ServiceMapComputer_CL` 和 `ServiceMapProcess_CL` 移动数据的更改将同时影响服务映射和 VM 见解，因此你仍需要规划此更新。\n\n如果选择不升级到“VMInsights”解决方案，我们将继续提供引用 `Perf` 表中数据的旧版本的性能工作簿。  \n"
  - question: >
      服务映射数据集也会存储在 InsightsMetrics 中吗？
    answer: "如果同时使用这两种解决方案，则将不会复制数据集。 这两个产品/服务都共享将存储在 `VMComputer`（以前为 ServiceMapComputer_CL）、`VMProcess`（以前为 ServiceMapProcess_CL）、`VMConnection` 和 `VMBoundPort` 表中的数据集，以存储所收集的地图数据集。  \n\n`InsightsMetrics` 表将存储所收集的 VM、进程和服务数据集，并且仅当你使用 VM 见解和 VM Insights 解决方案时才会填充。 服务映射解决方案不会在 `InsightsMetrics` 表中收集或存储数据。\n"
  - question: >
      如果我的工作区中有服务映射和 VMInsights 解决方案，是否会双倍收费？
    answer: >
      不会，这两个解决方案共享存储在 `VMComputer`（以前为 ServiceMapComputer_CL）、`VMProcess`（以前为 ServiceMapProcess_CL）、`VMConnection` 和 `VMBoundPort` 中的地图数据集。 如果工作区中同时具有这两个解决方案，不会双倍收费。
  - question: >
      如果删除服务映射或 VMInsights 解决方案，是否会删除我的数据？
    answer: >
      不会，这两个解决方案共享存储在 `VMComputer`（以前为 ServiceMapComputer_CL）、`VMProcess`（以前为 ServiceMapProcess_CL）、`VMConnection` 和 `VMBoundPort` 中的地图数据集。 如果删除其中一个解决方案，则这些数据集会注意到，仍存在一个使用数据的解决方案，并且该解决方案仍保留在 Log Analytics 工作区中。 需要从工作区中同时删除这两个解决方案才能从中删除数据。
  - question: >
      运行状况功能处于有限的公共预览版阶段
    answer: "我们从客户那里收到了有关 VM 运行状况功能集的大量正面反馈。 客户对这项功能非常感兴趣，并非常期待其支持监视工作流的潜力。 我们计划进行一系列的更改，目的是增添功能并处理收到的反馈。 \n\n为了最大限度地减少这些更改对新客户的影响，我们已将此功能移至“有限的公共预览版”。 此更新发生于 2019 年 10 月。\n\n我们计划在 2020 年（VM 见解正式发布后），重新启动此运行状况功能。\n"
  - question: >
      现有客户如何访问运行状况功能？
    answer: "使用运行状况功能的现有客户将继续具有此功能的访问权限，但新客户不具有访问权限。  \n\n若要访问该功能，可以将以下功能标志 `feature.vmhealth=true` 添加到 Azure 门户 URL [https://portal.azure.com](https://portal.azure.com)。 示例 `https://portal.azure.com/?feature.vmhealth=true`。\n\n你还可以使用此短 URL，它会自动设置功能标志：[https://aka.ms/vmhealthpreview](https://aka.ms/vmhealthpreview)。\n\n作为现有客户，你可以继续在连接到具有运行状况功能的现有工作区的 VM 上使用运行状况功能。  \n"
  - question: >
      我现在在一个环境中使用 VM 运行状况，并希望将其部署到新环境中
    answer: >
      如果你是使用运行状况功能的现有客户，并想要将其用于新的推出，请通过 vminsights@microsoft.com 联系我们以获取说明。
additionalContent: "\n## <a name=\"next-steps\"></a>后续步骤\n\n请参阅[部署 VM 见解](./vminsights-enable-overview.md)，了解有助于监视虚拟机的要求和方法。"
