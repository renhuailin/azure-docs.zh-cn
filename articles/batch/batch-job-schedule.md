---
title: 计划作业
description: 使用作业计划来管理任务。
ms.topic: how-to
ms.date: 07/16/2021
ms.custom: seodec18
ms.openlocfilehash: a247be1826cd68ef2ac1302c1910eae74b2d65b6
ms.sourcegitcommit: 8669087bcbda39e3377296c54014ce7b58909746
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/18/2021
ms.locfileid: "114405726"
---
# <a name="schedule-jobs-for-efficiency"></a>计划作业以提高效率

计划 Batch 作业可以指定你要最先运行的作业的优先级，同时还可以考虑到[依赖于其他任务的任务](batch-task-dependencies.md)。 计划作业可以确保使用最少量的资源。 可以关闭不再需要的节点；可以即时运行依赖于其他任务的任务来优化工作流。 还可以将作业设置为自动完成，因为每次只会运行一个作业，在前一个作业完成之前，不会启动新的作业。

使用作业管理器任务计划的任务会与某个作业相关联。 作业管理器任务将为作业创建任务。 为此，作业管理器任务需要使用 Batch 帐户进行身份验证。 使用 AZ_BATCH_AUTHENTICATION_TOKEN 访问令牌。 使用该令牌可以访问作业的其他部分。

若要使用 Azure CLI 来管理作业，请参阅 [az batch job-schedule](/cli/azure/batch/job-schedule)。 还可以在 Azure 门户中创建作业计划。

## <a name="schedule-a-job-in-the-azure-portal"></a>在 Azure 门户中计划作业

1. 登录 [Azure 门户](https://portal.azure.com/)。
1. 选择要在其中计划作业的 Batch 帐户。
1. 在左侧导航窗格中，选择“作业计划”。
1. 选择“添加”以创建新的作业计划。
1. 在“基本窗体”中输入以下信息：
   - 作业计划 ID：此作业计划的唯一标识符。
   - 显示名称：此名称是可选的，不要求唯一。 其长度不能超过 1024 个字符。
   - **不要在以下时间之前运行**：指定运行作业的最早时间。 如果未设置此字段，则表明计划已准备好立即运行作业。
   - 不要在以下时间之后运行：在此处输入的时间过后不会运行任何作业。 如果未指定时间，则会创建一个重复作业计划，在显式终止该计划之前，它会一直保持有效状态。
   - 重复间隔：如果你要指定每两个作业的间隔时间，请选择“已启用” 。 一次只能计划一个作业，因此，如果到了在作业计划下创建新作业的时间，但上一个作业仍在运行，则在上一个作业完成之前，Batch 服务不会创建新作业。
   - 启动时段：如果你要指定必须创建作业的时间间隔，请选择“自定义” 。 如果在此时段内未创建作业，则在计划的下一个重复周期之前不会创建新作业。

     :::image type="content" source="media/batch-job-schedule/add-job-schedule-02.png" alt-text="Azure 门户中“添加作业计划”选项的屏幕截图。":::  

1. 在“基本窗体”的底部，指定要在其中运行该作业的池。 若要从 Batch 帐户中的池列表进行选择，请选择“更新”。
1. 连同“池 ID”一起输入以下信息：
   - 作业配置任务：选择“更新”以命名并配置作业管理器任务，以及作业准备任务和作业发布任务（如果使用的话） 。
   - 显示名称：此名称是可选的，不要求唯一。 其长度不能超过 1024 个字符。
   - 优先级：使用滑块设置作业的优先级，或在框中输入值。
   - 最大挂钟时间：如果你要设置作业的最大运行时长，请选择“自定义” 。 选择此项后，如果该作业未在此期限内完成，Batch 会将它终止。
   - 最大任务重试次数：如果你要指定任务的可重试次数，请选择“自定义”；如果你希望任务根据需要尝试任意次数，请选择“无限制”  。 此值不同于可以重试 API 调用的次数。
   - 当所有任务完成时：默认值为“NoAction”，但如果你希望所有任务已完成时终止作业（或者作业中没有任何任务），则可以选择“TerminateJob” 。
   - 任务失败时：如果已用完重试次数或者启动任务时出错，则任务会失败。 默认值为“NoAction”，但如果你希望在任务失败时执行与该任务的退出条件关联的操作，则可以选择“PerformExitOptionsJobAction”。

     :::image type="content" source="media/batch-job-schedule/add-job-schedule-03.png" alt-text="Azure 门户中新作业计划的作业规范选项的屏幕截图。":::

1. 选择“保存”以创建作业计划。

若要跟踪作业的执行，请返回“作业计划”并选择作业计划。 展开“执行信息”查看详细信息。 在此屏幕中还可以终止、删除或禁用作业计划。

## <a name="next-steps"></a>后续步骤

- 详细了解[作业和任务](jobs-and-tasks.md)。
- [创建任务依赖关系](batch-task-dependencies.md)以运行依赖于其他任务的任务。
