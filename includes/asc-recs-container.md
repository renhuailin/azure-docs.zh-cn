---
author: memildin
ms.service: security-center
ms.topic: include
ms.date: 09/05/2021
ms.author: memildin
ms.custom: generated
ms.openlocfilehash: bdc98523c2c9795f3f69baeaef7599352ff9e4dc
ms.sourcegitcommit: f2d0e1e91a6c345858d3c21b387b15e3b1fa8b4c
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/07/2021
ms.locfileid: "123536819"
---
这一类别有 **23** 条相关建议。

|建议 |说明 |严重性 |
|---|---|---|
|[\[必要时启用\] 容器注册表应使用客户管理的密钥 (CMK) 进行加密](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/af560c4d-9c05-e073-b9f1-f7a94958ff25) |默认情况下，不会评估使用客户管理的密钥来加密静态数据的建议，但仍会显示这些建议以便为适用的方案启用。 将会使用平台管理的密钥自动对数据进行加密，因此，只有在合规性或限制性策略要求强制时，才应应用客户管理的密钥。 <br> 若要启用此建议，请导航到适用作用域的安全策略，并更新相应策略的 *Effect* 参数以审核或强制使用客户管理的密钥。 有关详细信息，请参阅<a href='/azure/security-center/tutorial-security-policy'>本指南</a>。 <br>使用客户管理的密钥来管理注册表内容的静态加密。 默认情况下，使用服务管理的密钥对数据进行静态加密，但为了满足监管合规标准，通常需要使用客户管理的密钥 (CMK)。 CMK 允许使用由你创建并拥有的 Azure Key Vault 密钥对数据进行加密。 你可以完全控制并负责关键生命周期，包括轮换和管理。 访问 https://aka.ms/acr/CMK，了解有关 CMK 加密的详细信息。<br />（相关策略：[容器注册表应使用客户管理的密钥 (CMK) 进行加密](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f5b9159ae-1701-4a6f-9a7a-aa9c8ddd0580)） |低 |
|[应启用适用于容器注册表的 Azure Defender](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/53572822-d3fc-4363-bfb9-248645841612) |若要生成安全的容器化工作负载，请确保它们所基于的映像不存在已知漏洞。<br>适用于容器注册表的 Azure Defender 会扫描注册表中每个推送的容器映像上是否有安全漏洞，并按映像显示详细的发现结果。<br>若要改进容器的安全状况并保护它们免受攻击，请启用适用于容器注册表的 Azure Defender。<br><br>重要说明：修正此建议将导致对容器注册表的保护产生费用。 如果此订阅中没有任何容器注册表，则不会产生任何费用。<br>如果将来在此订阅中创建任何容器注册表，它将自动受到保护，届时将开始计费。<br> <a href='/azure/security-center/azure-container-registry-integration'>详细了解适用于容器注册表的 Azure Defender。</a><br />（相关策略：[应启用适用于容器注册表的 Azure Defender](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fmicrosoft.authorization%2fpolicyDefinitions%2fc25d9a16-bc35-4e15-a7e5-9db606bf9ed4)） |高 |
|[应启用 Azure Defender for Kubernetes](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/86ea1a79-29d3-4eac-a9f4-3541ace4e718) |Azure Defender for Kubernetes 为容器化环境提供实时威胁防护，并针对可疑活动生成警报。<br>可以使用此信息快速补救安全问题，并提高容器的安全性。<br><br>重要说明：修正此建议将导致对 Kubernetes 群集的保护产生费用。 如果此订阅中没有任何 Kubernetes 群集，则不会产生任何费用。<br>如果将来在此订阅中创建任何 Kubernetes 群集，它将自动受到保护，届时将开始计费。<br> <a href='/azure/security-center/azure-kubernetes-service-integration'>详细了解 Azure Defender for Kubernetes。</a><br />（相关策略：[应启用 Azure Defender for Kubernetes](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fmicrosoft.authorization%2fpolicyDefinitions%2f523b5cd1-3e23-492f-a539-13118b6d1e3a)） |高 |
|[Azure Kubernetes 服务群集应安装适用于 Kubernetes 的 Azure Policy 加载项](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/08e628db-e2ed-4793-bc91-d13e684401c3) |适用于 Kubernetes 的 Azure Policy 加载项扩展了 <a target="_blank" href="https://github.com/open-policy-agent/gatekeeper">Gatekeeper</a> v3（用于<a target="_blank" href="https://www.openpolicyagent.org/">开放策略代理</a> (OPA) 的许可控制器 Webhook），以集中、一致的方式在群集上应用大规模强制措施和安全措施。<p>安全中心要求加载项审核并强制实施群集内的安全功能和合规性。 <a target="_blank" href="/azure/governance/policy/concepts/policy-for-kubernetes">了解详细信息</a>。</p><p>需要 Kubernetes v1.14.0 或更高版本。</p><br />（相关策略：[应在群集上安装并启用适用于 Kubernetes 服务 (AKS) 的 Azure Policy 加载项](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f0a15ec92-a229-4763-bb14-0ea34a568f8d)） |高 |
|[应强制执行容器 CPU 和内存限制](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/405c9ae6-49f9-46c4-8873-a86690f27818) |强制执行 CPU 和内存限制可阻止资源耗尽攻击（一种拒绝服务攻击形式）。<p>建议为容器设置限制，以确保运行时防止容器使用的资源超过配置的资源限制。</p><br />（相关策略：[确保容器 CPU 和内存资源限制不超过 Kubernetes 群集中指定的限制](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2fe345eecc-fa47-480f-9e88-67dcc122b164)） |中型 |
|[应只从受信任的注册表中部署容器映像](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/8d244d29-fa00-4332-b935-c3a51d525417) |在 Kubernetes 群集上运行的映像应来自已知和监视的容器映像注册表。 受信任的注册表通过限制引入未知漏洞、安全问题和恶意映像的可能性，降低群集暴露风险。<br />（相关策略：[确保只有允许使用的容器映像才在 Kubernetes 群集中运行](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2ffebd0533-8e55-448f-b837-bd0e06f16469)） |高 |
|[容器注册表不得允许无限制的网络访问](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/9b828565-a0ed-61c2-6bf3-1afc99a9b2ca) |默认情况下，Azure 容器注册表接受来自任何网络上的主机的 Internet 连接。 为了防止注册表受到潜在的威胁，只允许来自特定的公共 IP 地址或地址范围的访问。 如果注册表没有 IP/防火墙规则或配置的虚拟网络，它将出现在不正常资源中。 有关容器注册表网络规则的详细信息，请访问 https://aka.ms/acr/portal/public-network 和 https://aka.ms/acr/vnet。<br />（相关策略：[容器注册表不得允许无限制的网络访问](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2fd0793b48-0edc-4296-a390-4c75d1bdfd71)） |中型 |
|[容器注册表应使用专用链接](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/13e7d036-6903-821c-6018-962938929bf0) |通过 Azure 专用链接，在没有源位置或目标位置的公共 IP 地址的情况下，也可以将虚拟网络连接到 Azure 服务。 专用链接平台处理使用者与服务之间通过 Azure 主干网络进行的连接。 通过将专用终结点映射到容器注册表（而不是整个服务），还可以防范数据泄露风险。 有关详细信息，请访问：https://aka.ms/acr/private-link。<br />（相关策略：[容器注册表应使用专用链接](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2fe8eef0a8-67cf-4eb4-9386-14b0e78733d4)） |中型 |
|[应避免使用特权提升的容器](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/43dc2a2e-ce69-4d42-923e-ab7d136f2cfe) |容器在 Kubernetes 群集中不应将特权提升到根目录。<br>AllowPrivilegeEscalation 属性控制进程是否可以获得比其父进程更多的特权。<br />（相关策略：[Kubernetes 群集不得允许容器特权提升](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f1c6e92c9-99f0-4e55-9cf2-0c234dc48f99)） |中型 |
|[应避免使用共享敏感主机命名空间的容器](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/802c0637-5a8c-4c98-abd7-7c96d89d6010) |若要防止容器外的特权提升，请避免 Pod 访问 Kubernetes 群集中的敏感主机命名空间（主机进程 ID 和主机 IPC）。<br />（相关策略：[Kubernetes 群集容器不得共享主机进程 ID 命名空间或主机 IPC 命名空间](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f47a1ee2f-2a2a-4576-bf2a-e0e36709c2b8)） |中型 |
|[容器应只侦听允许的端口](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/5f88450f-9546-4b78-a181-a2d9162bb441) |要减少 Kubernetes 群集的受攻击面，请限制容器对已配置端口的访问权限，以此限制对群集的访问权限。<br />（相关策略：[确保容器仅侦听 Kubernetes 群集中允许的端口](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f440b515e-a580-421e-abeb-b159a61ddcbc)） |中型 |
|[应强制对容器使用不可变（只读）根文件系统](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/27d6f0e9-b4d5-468b-ae7e-03d5473fd864) |Kubernetes 群集中的容器应使用只读根文件系统。 不可变文件系统将恶意二进制文件添加到路径，可防止容器在运行时更改。<br />（相关策略：[Kubernetes 群集容器应使用只读根文件系统运行](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2fdf49d893-a74c-421d-bc95-c663042e5b80)） |中型 |
|[应为 Kubernetes API 服务器配置受限访问权限](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/1a2b5b4c-f80d-46e7-ac81-b51a9fb363de) |若要确保只有来自允许的网络、计算机或子网的应用程序可以访问群集，请限制对 Kubernetes API 服务器的访问权限。 可以通过定义授权的 IP 范围或将 API 服务器设置为专用群集（如 /azure/aks/private-clusters 中所述）来限制访问权限<br />（相关策略：[应在 Kubernetes 服务上定义经授权的 IP 范围](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f0e246bcf-5f6f-4f87-bc6f-775d4712c7ea)） |高 |
|[Kubernetes 群集应只可通过 HTTPS 进行访问](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/c6d87087-9ebe-b31f-b452-0bf3bbbaccd2) |使用 HTTPS 可确保执行身份验证，并保护传输中的数据不受网络层窃听攻击威胁。 此功能目前已面向 Kubernetes 服务 (AKS) 正式发布，并面向 AKS 引擎和启用了 Azure Arc 的 Kubernetes 提供预览版。 有关详细信息，请访问 https://aka.ms/kubepolicydoc<br />（相关策略：[在 Kubernetes 群集中强制实施 HTTPS 入口](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f1a5b4dca-0b6f-4cf5-907c-56316bc1bf3d)） |高 |
|[应强制对容器使用最低权限 Linux 功能](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/11c95609-3553-430d-b788-fd41cde8b2db) |为了减少容器的攻击面，请限制 Linux 功能，并向容器授予特定特权，而不授予根用户的所有特权。 建议先删除所有功能，再添加所需的功能<br />（相关策略：[Kubernetes 群集容器只应使用允许的功能](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2fc26596ff-4d70-4e6a-9a30-c2506bd2f80c)） |中型 |
|[应限制替代或禁用容器 AppArmor 配置文件](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/86f91051-9d6a-47c3-a07f-bd14cb214b45) |在 Kubernetes 集群上运行的容器应仅限使用允许的 AppArmor 配置文件。<br>AppArmor（应用程序防御）是一种 Linux 安全模块，可保护操作系统及其应用程序免受安全威胁。 为使用此模块，系统管理员需要将 AppArmor 安全配置文件与每个程序相关联。<br />（相关策略：[Kubernetes 群集容器只应使用允许的 AppArmor 配置文件](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f511f5417-5d12-434d-ab2e-816901e72a5e)） |高 |
|[应避免特权容器](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/5d90913f-a1c5-4429-ad54-2c6c17fb3c73) |要防止主机访问不受限制，请尽可能避免使用特权容器。<p>特权容器具有主机的所有根功能。 它们可用作攻击的入口点，并将恶意代码或恶意软件传播到受攻击的应用程序、主机和网络。</p><br />（相关策略：[不允许 Kubernetes 群集中有特权容器](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f95edb821-ddaf-4404-9732-666045e056b4)） |中型 |
|[应在 Kubernetes 服务上使用基于角色的访问控制](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/b0fdc63a-38e7-4bab-a7c4-2c2665abbaa9) |若要对用户可以执行的操作提供粒度筛选，请使用基于角色的访问控制 (RBAC) 来管理 Kubernetes 服务群集中的权限并配置相关授权策略。 有关详细信息，请参阅 <a target='_blank' href='/azure/aks/concepts-identity#role-based-access-controls-rbac'>Azure 基于角色的访问控制</a>。<br />（相关策略：[应在 Kubernetes 服务中使用基于角色的访问控制 (RBAC)](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2fac4a19c2-fa67-49b4-8ae5-0b2e78c49457)） |高 |
|[应避免以根用户身份运行容器](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/9b795646-9130-41a4-90b7-df9eae2437c8) |不得在容器在 Kubernetes 群集中以根用户身份运行容器。 在容器内以根用户身份运行进程会导致在主机上以根用户身份运行该进程。 如果遭到入侵，攻击者会获得容器中的根权限，任何配置错误都变得更加容易被利用。<br />（相关策略：[Kubernetes 群集 Pod 和容器只应使用批准的用户 ID 和组 ID 运行](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2ff06ddb64-5fa3-4b77-b166-acb36f7f6042)） |高 |
|[服务应只侦听允许的端口](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/add45209-73f6-4fa5-a5a5-74a451b07fbe) |要减少 Kubernetes 群集的受攻击面，请限制服务对已配置端口的访问权限，以此限制对群集的访问权限。<br />（相关策略：[确保服务只在 Kubernetes 群集中侦听允许使用的端口](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f233a2a17-77ca-4fb1-9b6b-69223d272a44)） |中型 |
|[应限制对主机网络和端口的使用](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/ebc68898-5c0f-4353-a426-4a5f1e737b12) |限制 Pod 在 Kubernetes 群集中对主机网络和允许的主机端口范围的访问。 在启用 hostNetwork 属性的情况下创建的 Pod 将共享该节点的网络空间。 为了避免被泄露的容器侦听网络流量，建议不要将 Pod 置于主机网络上。 如果需要在节点的网络上公开容器端口，并且使用 Kubernetes 服务节点端口不能满足你的需求，另一个可能的做法是在 Pod 规范中为容器指定 hostPort。<br />（相关策略：[Kubernetes 群集 Pod 只应使用批准的主机网络和端口范围](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f82985f06-dc18-4a48-bc1c-b9f4f0098cfe)） |中型 |
|[应限制为只有已知列表才能使用 Pod HostPath 卷装载，以限制来自遭入侵容器的节点访问](https://portal.azure.com/#blade/Microsoft_Azure_Security/RecommendationsBlade/assessmentKey/f0debc84-981c-4a0d-924d-aa4bd7d55fef) |建议将 Kubernetes 群集中的 pod HostPath 卷装载限制为配置的允许主机路径。 如果遭到入侵，应限制容器对容器节点的访问。<br />（相关策略：[Kubernetes 群集 Pod hostPath 卷只应使用允许的主机路径](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f098fc59e-46c7-4d99-9b16-64990e543d75)） |中型 |
|应修正 Azure 容器注册表映像中的漏洞（由 Qualys 提供技术支持） |容器映像漏洞评估功能会扫描注册表中的安全漏洞，并公开每个映像的详细发现结果。 修复这些漏洞可以极大改善容器的安全状况，并保护其不受攻击影响。<br />（相关策略：[应修正 Azure 容器注册表映像中的漏洞](https://portal.azure.com/#blade/Microsoft_Azure_Policy/PolicyDetailBlade/definitionId/%2fproviders%2fMicrosoft.Authorization%2fpolicyDefinitions%2f5f0f936f-2f01-4bf5-b6be-d423792fa562)） |高 |
|||
